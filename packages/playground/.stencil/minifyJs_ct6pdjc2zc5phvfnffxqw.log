var __awaiter = this && this.__awaiter || function(e, t, n, r) {
  return new (n || (n = Promise))(function(o, i) {
    function fulfilled(e) {
      try {
        step(r.next(e));
      } catch (e) {
        i(e);
      }
    }
    function rejected(e) {
      try {
        step(r.throw(e));
      } catch (e) {
        i(e);
      }
    }
    function step(e) {
      e.done ? o(e.value) : new n(function(t) {
        t(e.value);
      }).then(fulfilled, rejected);
    }
    step((r = r.apply(e, t || [])).next());
  });
}, __generator = this && this.__generator || function(e, t) {
  var n, r, o, i, a = {
    label: 0,
    sent: function() {
      if (1 & o[0]) throw o[1];
      return o[1];
    },
    trys: [],
    ops: []
  };
  return i = {
    next: verb(0),
    throw: verb(1),
    return: verb(2)
  }, "function" == typeof Symbol && (i[Symbol.iterator] = function() {
    return this;
  }), i;
  function verb(i) {
    return function(s) {
      return function(i) {
        if (n) throw new TypeError("Generator is already executing.");
        for (;a; ) try {
          if (n = 1, r && (o = 2 & i[0] ? r.return : i[0] ? r.throw || ((o = r.return) && o.call(r), 
          0) : r.next) && !(o = o.call(r, i[1])).done) return o;
          switch (r = 0, o && (i = [ 2 & i[0], o.value ]), i[0]) {
           case 0:
           case 1:
            o = i;
            break;

           case 4:
            return a.label++, {
              value: i[1],
              done: !1
            };

           case 5:
            a.label++, r = i[1], i = [ 0 ];
            continue;

           case 7:
            i = a.ops.pop(), a.trys.pop();
            continue;

           default:
            if (!(o = (o = a.trys).length > 0 && o[o.length - 1]) && (6 === i[0] || 2 === i[0])) {
              a = 0;
              continue;
            }
            if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
              a.label = i[1];
              break;
            }
            if (6 === i[0] && a.label < o[1]) {
              a.label = o[1], o = i;
              break;
            }
            if (o && a.label < o[2]) {
              a.label = o[2], a.ops.push(i);
              break;
            }
            o[2] && a.ops.pop(), a.trys.pop();
            continue;
          }
          i = t.call(e, a);
        } catch (e) {
          i = [ 6, e ], r = 0;
        } finally {
          n = o = 0;
        }
        if (5 & i[0]) throw i[1];
        return {
          value: i[0] ? i[1] : void 0,
          done: !0
        };
      }([ i, s ]);
    };
  }
};

App.loadBundle("/**:bundle-id:**/", [ "exports", "./chunk-346f9d40.js", "./chunk-faed910a.js", "./chunk-00addb69.js", "./chunk-f52e57f9.js", "./chunk-cc018d56.js", "./chunk-84817f4c.js" ], function(e, t, n, r, o, i, a) {
  var s = window.App.h, l = /** @class */ function() {
    function DialogInsufficientFunds() {
      this.onDeposit = function() {}, this.onReject = function() {};
    }
    return DialogInsufficientFunds.prototype.render = function() {
      var e = this;
      return s("widget-dialog", {
        visible: !0,
        dialogTitle: "Insufficient funds",
        content: s("label", null, "You need at least", " ", window.ethers.utils.formatEther(this.message.minimumEthBalance), " ", "ETH to ETH in your Playground account to install this game."),
        primaryButtonText: "Deposit",
        onPrimaryButtonClicked: function() {
          return e.onDeposit();
        },
        secondaryButtonText: "Reject",
        onSecondaryButtonClicked: function() {
          return e.onReject();
        }
      });
    }, Object.defineProperty(DialogInsufficientFunds, "is", {
      get: function() {
        return "dialog-insufficient-funds";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogInsufficientFunds, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogInsufficientFunds, "properties", {
      get: function() {
        return {
          message: {
            type: "Any",
            attr: "message"
          },
          onDeposit: {
            type: "Any",
            attr: "on-deposit"
          },
          onReject: {
            type: "Any",
            attr: "on-reject"
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), DialogInsufficientFunds;
  }(), u = /** @class */ function() {
    function DialogProposeInstall() {
      this.el = {}, this.onAccept = function() {}, this.onReject = function() {}, this.apps = [], 
      this.user = {};
    }
    return DialogProposeInstall.prototype.componentWillLoad = function() {
      return __awaiter(this, void 0, void 0, function() {
        var e;
        return __generator(this, function(t) {
          switch (t.label) {
           case 0:
            return this.message.data ? (e = this, [ 4 /*yield*/ , a.PlaygroundAPIClient.getUserByNodeAddress(this.message.data.proposedByIdentifier) ]) : [ 3 /*break*/ , 2 ];

           case 1:
            e.user = t.sent(), t.label = 2;

           case 2:
            return [ 2 /*return*/ ];
          }
        });
      });
    }, DialogProposeInstall.prototype.render = function() {
      var e = this, t = this.apps.find(function(t) {
        return t.id[42] === e.message.data.params.appDefinition;
      });
      if (!t) throw Error("You've received an installation proposal from a different Ethereum network");
      return s("widget-dialog", {
        visible: !0,
        dialogTitle: "You've been invited to play!",
        content: s("label", null, "You'll need to deposit", s("br", null), s("strong", null, window.ethers.utils.formatEther(this.message.data.params.initiatorDeposit), " ", "ETH"), " ", "to play ", s("strong", null, t.name), " with", " ", s("strong", null, this.user.username), "."),
        primaryButtonText: "Accept",
        onPrimaryButtonClicked: function() {
          return e.onAccept(e.message);
        },
        secondaryButtonText: "Reject",
        onSecondaryButtonClicked: function() {
          return e.onReject();
        }
      });
    }, Object.defineProperty(DialogProposeInstall, "is", {
      get: function() {
        return "dialog-propose-install";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogProposeInstall, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogProposeInstall, "properties", {
      get: function() {
        return {
          apps: {
            type: "Any",
            attr: "apps"
          },
          el: {
            elementRef: !0
          },
          message: {
            type: "Any",
            attr: "message"
          },
          onAccept: {
            type: "Any",
            attr: "on-accept"
          },
          onReject: {
            type: "Any",
            attr: "on-reject"
          },
          user: {
            state: !0
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), DialogProposeInstall;
  }();
  r.AppRegistryTunnel.injectProps(u, [ "apps" ]);
  var c = /** @class */ function() {
    function DialogRejectInstall() {
      this.onOKClicked = function() {}, this.onReject = function() {}, this.username = "";
    }
    return DialogRejectInstall.prototype.componentWillLoad = function() {
      var e = JSON.parse(window.localStorage.getItem("playground:lastMatchmake") || '{"attributes":{"username":"Your opponent"}}');
      this.username = e.data.attributes.username;
    }, DialogRejectInstall.prototype.render = function() {
      var e = this;
      return s("widget-dialog", {
        visible: !0,
        dialogTitle: "Sorry :(",
        content: s("label", null, s("strong", null, this.username), " has declined your invitation to play."),
        primaryButtonText: "OK",
        onPrimaryButtonClicked: function() {
          return e.onOKClicked();
        }
      });
    }, Object.defineProperty(DialogRejectInstall, "is", {
      get: function() {
        return "dialog-reject-install";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogRejectInstall, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(DialogRejectInstall, "properties", {
      get: function() {
        return {
          message: {
            type: "Any",
            attr: "message"
          },
          onOKClicked: {
            type: "Any",
            attr: "on-o-k-clicked"
          },
          onReject: {
            type: "Any",
            attr: "on-reject"
          },
          username: {
            state: !0
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), DialogRejectInstall;
  }(), d = /** @class */ function() {
    function HeaderDrawer() {
      this.closeDrawer = {}, this.opened = !1;
    }
    return HeaderDrawer.prototype.menuClicked = function(e) {
      e.preventDefault(), this.closeDrawer.emit();
    }, HeaderDrawer.prototype.render = function() {
      var e = this;
      return s("div", {
        class: this.opened ? "drawer-container opened" : "drawer-container"
      }, s("a", {
        onClick: function(t) {
          return e.menuClicked(t);
        },
        class: "drawer-screen"
      }), s("menu", {
        class: "drawer"
      }, s("header-content", null)));
    }, Object.defineProperty(HeaderDrawer, "is", {
      get: function() {
        return "header-drawer";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(HeaderDrawer, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(HeaderDrawer, "properties", {
      get: function() {
        return {
          opened: {
            type: Boolean,
            attr: "opened"
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(HeaderDrawer, "events", {
      get: function() {
        return [ {
          name: "closeDrawer",
          method: "closeDrawer",
          bubbles: !0,
          cancelable: !0,
          composed: !0
        } ];
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(HeaderDrawer, "style", {
      get: function() {
        return "/**style-placeholder:header-drawer:**/";
      },
      enumerable: !0,
      configurable: !0
    }), HeaderDrawer;
  }(), p = /** @class */ function() {
    function LayoutHeader() {
      this.drawerOpened = !1;
    }
    return LayoutHeader.prototype.closeDrawerHandler = function(e) {
      this.drawerOpened = !1;
    }, LayoutHeader.prototype.openDrawerHandler = function(e) {
      this.drawerOpened = !0;
    }, LayoutHeader.prototype.render = function() {
      var e = this;
      return [ s("header-drawer", {
        opened: this.drawerOpened,
        onCloseDrawer: function(t) {
          return e.closeDrawerHandler(t);
        }
      }), s("header", {
        class: "header"
      }, s("div", {
        class: "hide-on-desktop"
      }, s("div", {
        class: "mobile-content"
      }, s("a", {
        class: "drawer-toggle",
        onClick: function(t) {
          return e.openDrawerHandler(t);
        }
      }, s("img", {
        src: "/assets/icon/menu-btn.svg",
        alt: "Menu"
      })), s("div", {
        class: "logo-container"
      }, s("stencil-route-link", {
        url: "/"
      }, s("img", {
        src: "/assets/icon/logo.svg",
        alt: "Counterfactual",
        class: "logo"
      }))), s("div", {
        class: "account-container"
      }, s("header-balance", null)))), s("div", {
        class: "hide-on-mobile desktop-wrapper"
      }, s("header-content", null))) ];
    }, Object.defineProperty(LayoutHeader, "is", {
      get: function() {
        return "layout-header";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(LayoutHeader, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(LayoutHeader, "properties", {
      get: function() {
        return {
          drawerOpened: {
            state: !0
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(LayoutHeader, "style", {
      get: function() {
        return "/**style-placeholder:layout-header:**/";
      },
      enumerable: !0,
      configurable: !0
    }), LayoutHeader;
  }(), f = /** @class */ function() {
    function NodeListener() {
      this.el = {}, this.apps = [], this.web3Detected = !1, this.history = {}, this.provider = {}, 
      this.ethMultisigBalance = window.ethers.constants.Zero, this.nodeMessageResolver = {
        proposeInstallVirtualEvent: this.onProposeInstallVirtual.bind(this),
        rejectInstallEvent: this.onRejectInstall.bind(this),
        rejectInstallVirtualEvent: this.onRejectInstall.bind(this)
      };
    }
    return Object.defineProperty(NodeListener.prototype, "cfProvider", {
      get: function() {
        return o.CounterfactualNode.getCfProvider();
      },
      enumerable: !0,
      configurable: !0
    }), NodeListener.prototype.componentWillLoad = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(e) {
          return this.web3Detected && this.bindNodeEvents(), [ 2 /*return*/ ];
        });
      });
    }, NodeListener.prototype.bindNodeEvents = function() {
      var e = this;
      Object.keys(this.nodeMessageResolver).forEach(function(t) {
        e.cfProvider.off(t), e.cfProvider.on(t, e.nodeMessageResolver[t].bind(e));
      });
    }, NodeListener.prototype.onProposeInstallVirtual = function(e) {
      this.currentMessage = e, this.showModal();
    }, NodeListener.prototype.onRejectInstall = function(e) {
      this.currentMessage = e, this.showModal();
    }, NodeListener.prototype.acceptProposeInstall = function(e) {
      return __awaiter(this, void 0, void 0, function() {
        var t, n, r, o, i, a;
        return __generator(this, function(s) {
          switch (s.label) {
           case 0:
            return s.trys.push([ 0, 2, , 3 ]), t = this.ethMultisigBalance, n = window.ethers.utils.bigNumberify(e.data.params.initiatorDeposit), 
            t.lt(n) ? (this.currentModalType = "error", this.currentErrorType = "INSUFFICIENT_FUNDS", 
            this.currentMessage = {
              minimumEthBalance: n
            }, [ 2 /*return*/ ]) : [ 4 /*yield*/ , this.cfProvider.installVirtual((r = this.currentMessage.data).appInstanceId, r.intermediaries[0]) ];

           case 1:
            if (o = s.sent(), !(i = this.apps.find(function(e) {
              return e.id[42] === o.appInstance.appDefinition;
            }))) throw Error("You've received an installation proposal from a different Ethereum network");
            return window.localStorage.setItem("playground:installingDapp", JSON.stringify({
              installedApp: o,
              name: i.name,
              dappContainerUrl: "/dapp/" + i.slug,
              dappUrl: i.url
            })), this.history.push("/dapp/" + i.slug), this.hideModal(), [ 3 /*break*/ , 3 ];

           case 2:
            return a = s.sent(), this.currentModalType = "error", this.currentErrorType = a.message, 
            console.error(a), [ 3 /*break*/ , 3 ];

           case 3:
            return [ 2 /*return*/ ];
          }
        });
      });
    }, NodeListener.prototype.rejectProposeInstall = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(e) {
          switch (e.label) {
           case 0:
            return [ 4 /*yield*/ , this.cfProvider.rejectInstall(this.currentMessage.data.appInstanceId) ];

           case 1:
            return e.sent(), this.hideModal(), [ 2 /*return*/ ];
          }
        });
      });
    }, NodeListener.prototype.showModal = function() {
      this.currentModalType = this.currentMessage.type;
    }, NodeListener.prototype.hideModal = function() {
      this.currentModalType = "none";
    }, NodeListener.prototype.render = function() {
      var e = this, t = {};
      return "proposeInstallVirtualEvent" === this.currentModalType && (t = s("dialog-propose-install", {
        message: this.currentMessage,
        onAccept: this.acceptProposeInstall.bind(this),
        onReject: this.rejectProposeInstall.bind(this)
      })), "rejectInstallVirtualEvent" !== this.currentModalType && "rejectInstallEvent" !== this.currentModalType || (t = s("dialog-reject-install", {
        message: this.currentMessage,
        onOKClicked: this.hideModal.bind(this)
      })), "error" === this.currentModalType && (t = "INSUFFICIENT_FUNDS" === this.currentErrorType ? s("dialog-insufficient-funds", {
        message: this.currentMessage,
        onDeposit: this.hideModal.bind(this),
        onReject: this.rejectProposeInstall.bind(this)
      }) : s("widget-dialog", {
        dialogTitle: "Something went wrong",
        content: this.currentErrorType + ". See the console for more info.",
        primaryButtonText: "OK",
        onPrimaryButtonClicked: function() {
          return e.hideModal();
        }
      })), [ s("slot", null), t ];
    }, Object.defineProperty(NodeListener, "is", {
      get: function() {
        return "node-listener";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(NodeListener, "encapsulation", {
      get: function() {
        return "shadow";
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(NodeListener, "properties", {
      get: function() {
        return {
          apps: {
            type: "Any",
            attr: "apps"
          },
          currentErrorType: {
            state: !0
          },
          currentMessage: {
            state: !0
          },
          currentModalType: {
            state: !0
          },
          el: {
            elementRef: !0
          },
          ethMultisigBalance: {
            type: "Any",
            attr: "eth-multisig-balance"
          },
          history: {
            type: "Any",
            attr: "history"
          },
          provider: {
            type: "Any",
            attr: "provider"
          },
          web3Detected: {
            type: Boolean,
            attr: "web-3-detected"
          }
        };
      },
      enumerable: !0,
      configurable: !0
    }), NodeListener;
  }();
  r.AppRegistryTunnel.injectProps(f, [ "apps" ]), n.AccountTunnel.injectProps(f, [ "ethMultisigBalance" ]), 
  i.WalletTunnel.injectProps(f, [ "web3Detected", "provider" ]), e.DialogInsufficientFunds = l, 
  e.DialogProposeInstall = u, e.DialogRejectInstall = c, e.HeaderDrawer = d, e.LayoutHeader = p, 
  e.NodeListener = f, Object.defineProperty(e, "__esModule", {
    value: !0
  });
});
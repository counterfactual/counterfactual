# CF-wallet.js API Specification for Wallet Environments

### `cf-wallet.js` Typescript Package

- `Provider`
    - Properties
        - `publicIdentifier`
    - Instance methods
        - `async install(appInstanceId): Promise<appInstance>`
            - [Node method](#method-install)
        - `async installVirtual(appInstanceId, intermediaries): Promise<appInstance>`
            - [Node method](#method-installvirtual)
        - `async rejectInstall(appInstanceId)`
            - [Node method](#method-rejectinstall)
        - `async rejectInstallVirtual(appInstanceId)`
            - [Node method](#method-rejectinstallvirtual)
        - `async createChannel(owners[]): Promise<CreateChannelTransactionResult>`
            - [Node method](#method-createchannel)
        - `async deposit(multisigAddress, amount, assetType?)`
            - [Node method](#method-deposit)
        - `async withdraw(multisigAddress, amount, assetType?)`
            - [Node method](#method-withdraw)
        - `async getFreeBalanceState(multisigAddress): Promise<ETHBucketAppState>`
            - [Node method](#method-getfreebalancestate)
        - `receiveMessage(cb)`
            - [Node method](#method-receivemessage)
        - `relyMessage(event)`
            - [Node method](#method-relymessage)

Public Methods
--------------

### Method: `install`

Install an app instance.

Params:
- `appInstanceId: string`
    - ID of the app instance to install
    - Counterparty must have called `proposedInstall` and generated this ID


Result:
- `appInstance:`[`AppInstanceInfo`](#data-type-appinstanceinfo)
    - Successfully installed app instance

### Method: `installVirtual`

Install a virtual app instance.

Params:
- `appInstanceId: string`
    - ID of the app instance to install
    - Counterparty must have called `proposedInstall` and generated this ID
- `intermediaries: Address[]`
    - List of addresses of intermediaries to route the virtual app installation through

Result:
- `appInstance:`[`AppInstanceInfo`](#data-type-appinstanceinfo)
    - Successfully installed app instance

### Method: `rejectInstall`

Reject an app instance installation.

Params:
- `appInstanceId: string`
    - ID of the app instance to reject

Result: "OK"

### Method: `rejectInstallVirtual`

Reject a virtual app instance installation.

Params:
- `appInstanceId: string`
    - ID of the app instance to reject

Result: "OK"

### Method: `createChannel`

Creates a channel by deploying a multisignature wallet contract.

Params:

- `owners: Address[]`
    - the addresses who should be the owners of the multisig

Result:

- `CreateChannelTransactionResult`
    - `transactionHash: string`
        - the hash of the multisig deployment transaction
            - This can be used to either register a listener for when the transaction has been mined or await the mining.

### Method: `deposit`

Deposits the specified amount of funds into the channel with the specified multisig address.

Params:

- `multisigAddress: string`
- `amount: BigNumber`
- `assetType?: BlockchainAsset`

Result:

- `ethBucketAppState: ETHBucketAppState`
    - the updated balance of the multisig

### Method: `withdraw`

Withdraws the specified amount of funds into the channel with the specified multisig address.

Params:

- `multisigAddress: string`
- `amount: BigNumber`
- `assetType?: BlockchainAsset`

Result:

- `ethBucketAppState: ETHBucketAppState`
    - the updated balance of the multisig

### Method: `getFreeBalanceState`

Queries for the current free balance state of the channel with the specified multisig address.

Params:

- `multisigAddress: string`

Result:

- `ethBucketAppState: ETHBucketAppState`
    - the balance of the multisig

### Method: `receiveMessage(cb)`

Handle incoming messages from the node.

Params:

- `cb: callback`
    - a callback which can post messages to a dapp

### Method: `relayMessage(event)`

Relays a message to the node.

Params:

- `event: MessageEvent`
    - the message generated by the dapp


Data Types
----------

### Data Type: `AppInstanceInfo`

An instance of an installed app.

- `id: string`
    - Opaque identifier used to refer to this app instance
    - No two distinct app instances (even in different channels) may share the same ID
- `appId: string`
    - On-chain address of App Definition contract
- `abiEncodings:`[`AppABIEncodings`](#data-type-appabiencodings)
    - ABI encodings used for states and actions of this app
- `asset:`[`BlockchainAsset`](#data-type-blockchainasset)
    - The asset used for deposits into this app
- `myDeposit: BigNumber`
    - Amount of the asset deposited by this user
- `peerDeposit: BigNumber`
    - Amount of the asset deposited by the counterparty
- `timeout: BigNumber`
    - Number of blocks until a submitted state for this app is considered finalized
- `intermediaries?: Address[]`
    - List of addresses of intermediaries for this virtual app instance. Undefined if app instance is not virtual

### Data Type: `BlockchainAsset`
- `assetType: number`
    - The type of the asset.
    - Set 0 for ETH, 1 for ERC20 token, 2 for Other.
- `token?: string`
    - Optional address of token contract if assetType is set to 1.

### Data Type: `AppABIEncodings`
- `stateEncoding: string`
    - ABI encoding of the app state
- `actionEncoding?: string`
    - Optional ABI encoding of the app action
    - If left blank, instances of the app will only be able to update state using [`proposeState`](#method-proposestate)
    - If supplied, instances of this app will also be able to update state using [`takeAction`](#method-takeaction)

### Data Type: `AppState`

- Plain Old Javascript Object representation of the state of an app instance.
- ABI encoded/decoded using the `stateEncoding` field on the instance's [`AppABIEncodings`](#data-type-appabiencodings).

### Data Type: `SolidityABIEncoderV2Struct`

- Plain Old Javascript Object representation of the action of an app instance.
- ABI encoded/decoded using the `actionEncoding` field on the instance's [`AppABIEncodings`](#data-type-appabiencodings).

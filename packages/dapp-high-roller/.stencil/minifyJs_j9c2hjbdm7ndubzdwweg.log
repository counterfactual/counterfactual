var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function i(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,i)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};App.loadBundle("/**:bundle-id:**/",["exports","./chunk-7a957887.js","./chunk-346f9d40.js","./chunk-48936b03.js"],function(t,e,n,r){var a=window.App.h,s=ethers.constants.HashZero,o=function(){function t(){this.el={},this.history={},this.appFactory={},this.betAmount="0.01",this.myName="",this.opponent={attributes:{}},this.intermediary="",this.isError=!1,this.isWaiting=!1,this.standalone=!1,this.updateAppInstance=function(){},this.updateOpponent=function(){}}return t.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.myName=this.account.user.username,[4,this.matchmake()];case 1:return[2,t.sent()]}})})},t.prototype.handlePlay=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,a;return __generator(this,function(o){switch(o.label){case 0:t.preventDefault(),o.label=1;case 1:return o.trys.push([1,3,,4]),e={stage:r.HighRollerStage.WAITING_FOR_P1_COMMITMENT,salt:s,commitHash:s,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0},n=ethers.utils.parseEther(this.account.balance),a=ethers.utils.parseEther(this.betAmount),n.lt(a)?(this.error="Insufficient funds: You need at least "+this.betAmount+" ETH to play.",[2]):a.gt(ethers.utils.parseEther("0.01"))||a.lt(ethers.utils.parseEther("0"))?(this.error="Please, place a bet between 0 and 0.01 ETH.",[2]):[4,this.appFactory.proposeInstallVirtual({initialState:e,proposedToIdentifier:this.opponent.attributes.nodeAddress,responderDeposit:ethers.utils.parseEther(this.betAmount),initiatorDeposit:ethers.utils.parseEther(this.betAmount),timeout:172800,intermediaries:[this.intermediary]})];case 2:return o.sent(),this.isWaiting=!0,[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},t.prototype.matchmake=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.fetchMatchmake()];case 1:return t=n.sent(),this.opponent={attributes:{username:t.data.attributes.username,nodeAddress:t.data.attributes.nodeAddress,ethAddress:t.data.attributes.ethAddress}},this.intermediary=t.data.attributes.intermediary,this.error=null,this.updateOpponent(this.opponent),[3,3];case 2:return e=n.sent(),this.error=e,[3,3];case 3:return[2]}})})},t.prototype.onErrorSet=function(){this.isError=!!this.error},t.prototype.handleChange=function(t,e){this[e]=t.target.value},t.prototype.fetchMatchmake=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.standalone?[2,{data:{type:"matchmaking",id:"2b83cb14-c7aa-5208-8da8-369aeb1a3f24",attributes:{intermediary:this.account.multisigAddress},relationships:{users:{data:{type:"users",id:this.account.user.id}},matchedUser:{data:{type:"matchedUsers",id:"3d54b508-b355-4323-8738-4cdf7290a2fd"}}}},included:[{type:"users",id:this.account.user.id,attributes:{username:this.account.user.username,ethAddress:this.account.user.ethAddress}},{type:"matchedUsers",id:"3d54b508-b355-4323-8738-4cdf7290a2fd",attributes:{username:"MyOpponent",ethAddress:"0x12345"}}]}]:[2,new Promise(function(t){var e=function(n){if(n.data.toString().startsWith("playground:response:matchmake")){window.removeEventListener("message",e);var r=n.data.split("|");t(JSON.parse(r[1]))}};window.addEventListener("message",e),window.parent.postMessage("playground:request:matchmake","*")})]})})},t.prototype.render=function(){var t=this;return this.isWaiting?a("app-waiting",{myName:this.myName,betAmount:this.betAmount,opponentName:this.opponent.attributes.username,isProposing:!0}):a("div",{class:"wrapper"},a("div",{class:"wager"},a("div",{class:"message"},a("img",{class:"message__icon",src:"/assets/images/logo.svg",alt:"High Roller"}),a("h1",{class:"message__title"},"Welcome!"),a("p",{class:"message__body"},"Ready to play?")),a("form",{class:"form",onSubmit:function(e){return t.handlePlay(e)}},a("label",{htmlFor:"myName"},"Your Name"),a("input",{class:"form__input",id:"myName",type:"text",placeholder:"Your name",value:this.myName,onInput:function(e){return t.handleChange(e,"myName")},readOnly:!0}),a("label",{htmlFor:"betAmount"},"Bet Amount ( ETH )"),a("input",{class:"form__input",id:"betAmount",type:"number",placeholder:"0.01",value:this.betAmount,onInput:function(e){return t.handleChange(e,"betAmount")},min:0,max:.01,step:1e-8}),this.isError?a("label",{class:"message__error"},this.error instanceof Error?this.error.message+": "+this.error.stack:this.error):{},a("button",{class:"form__button"},a("div",null,"Play!")))))},Object.defineProperty(t,"is",{get:function(){return"app-wager"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{account:{type:"Any",attr:"account"},appFactory:{type:"Any",attr:"app-factory"},betAmount:{state:!0},el:{elementRef:!0},error:{state:!0,watchCallbacks:["onErrorSet"]},history:{type:"Any",attr:"history"},intermediary:{state:!0},isError:{state:!0},isWaiting:{state:!0},myName:{state:!0},opponent:{state:!0},standalone:{type:Boolean,attr:"standalone"},updateAppInstance:{type:"Any",attr:"update-app-instance"},updateOpponent:{type:"Any",attr:"update-opponent"}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"/**style-placeholder:app-wager:**/"},enumerable:!0,configurable:!0}),t}();r.CounterfactualTunnel.injectProps(o,["appFactory","updateAppInstance","account","opponent","standalone"]);var i=function(){function t(){this.el={},this.history={},this.myName="",this.betAmount="",this.opponentName="",this.isProposing=!1,this.seconds=60,this.isCountdownStarted=!1}return t.prototype.componentWillLoad=function(){this.betAmount=e.getProp("betAmount",this),this.isProposing=e.getProp("isProposing",this)},t.prototype.componentDidLoad=function(){this.setupWaiting()},t.prototype.countDown=function(){var t=this;1!==this.seconds&&setTimeout(function(){t.seconds=t.seconds-1,t.countDown()},1e3)},t.prototype.goToGame=function(t,e){console.log("GO TO GAME: "+t),this.history.push({pathname:"/game",state:{appInstanceId:e,opponentName:t,betAmount:this.betAmount,myName:this.myName,isProposing:this.isProposing},query:{},key:""})},t.prototype.startCountdown=function(){this.isCountdownStarted||(this.isCountdownStarted=!0,this.countDown())},t.prototype.setupWaiting=function(t,e,n,r){this.isProposing?this.setupWaitingProposing():this.setupWaitingAccepting()},t.prototype.setupWaitingProposing=function(){this.isCountdownStarted||this.startCountdown()},t.prototype.setupWaitingAccepting=function(){var t=this;this.cfProvider.once("updateState",function(){t.goToGame(t.opponentName,t.appInstance.id)}),this.myName=this.account.user.username,this.opponentName=this.opponent.attributes.username},t.prototype.render=function(){return a("div",{class:"wrapper"},a("div",{class:"waiting"},a("div",{class:"message"},a("img",{class:"message__icon",src:"/assets/images/logo.svg",alt:"High Roller"}),a("h1",{class:"message__title"},"Waiting Room"),a("p",{class:"message__body"},this.isProposing?"Waiting for another player to join the game in":"Waiting on "+this.opponentName+"'s roll..."),this.isProposing?a("p",{class:"countdown"},this.seconds):{},a("p",null,"Player: ",this.myName," ",a("br",null),"Opponent: ",this.opponentName," ",a("br",null),"Bet Amount: ",this.betAmount," ETH"))))},Object.defineProperty(t,"is",{get:function(){return"app-waiting"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{account:{type:"Any",attr:"account"},appInstance:{type:"Any",attr:"app-instance"},betAmount:{type:String,attr:"bet-amount",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider"},el:{elementRef:!0},history:{type:"Any",attr:"history"},isCountdownStarted:{state:!0},isProposing:{type:Boolean,attr:"is-proposing",mutable:!0},myName:{type:String,attr:"my-name",mutable:!0},opponent:{type:"Any",attr:"opponent"},opponentName:{type:String,attr:"opponent-name",mutable:!0},seconds:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"/**style-placeholder:app-waiting:**/"},enumerable:!0,configurable:!0}),t}();r.CounterfactualTunnel.injectProps(i,["cfProvider","appInstance","account","opponent"]),t.AppWager=o,t.AppWaiting=i,Object.defineProperty(t,"__esModule",{value:!0})});
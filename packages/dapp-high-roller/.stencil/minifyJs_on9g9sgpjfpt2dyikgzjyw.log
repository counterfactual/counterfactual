var __awaiter=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new a(function(t){t(e.value)}).then(i,l)}s((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var a,n,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{a=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};App.loadBundle("/**:bundle-id:**/",["exports","./chunk-7a957887.js","./chunk-346f9d40.js","./chunk-48936b03.js","./chunk-b4eb213b.js"],function(e,t,a,n,r){var o=window.App.h,i=ethers.constants.HashZero,l=ethers.utils.bigNumberify,s=function(){function e(){this.el={},this.history={},this.betAmount="0.01 ETH",this.isProposing=!1,this.appInstanceId="",this.cfProvider={},this.appInstance={},this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.generateRandomRoll=function(){return[]},this.gameStatusLabel="",this.defaultHighRollerState={stage:n.HighRollerStage.WAITING_FOR_P1_COMMITMENT,salt:i,commitHash:i,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0},this.highRollerState=this.defaultHighRollerState,this.gameState=n.GameState.Play,this.myRoll=[1,1],this.myScore=0,this.opponentRoll=[1,1],this.opponentScore=0,this.updateUIState=function(){},this.rollingAnimationInterval={},this.rolling={myRoll:!1,opponentRoll:!1}}return e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.betAmount=t.getProp("betAmount",this),this.isProposing=t.getProp("isProposing",this),this.appInstanceId=t.getProp("appInstanceId",this),[2]})})},e.prototype.onHighRollerStateChanged=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.highRollerState.stage!==n.HighRollerStage.P2_COMMITTED_TO_NUM||this.rolling.opponentRoll?[3,2]:[4,this.beginRolling("opponentRoll")];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.onGameStateChanged=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.gameState===n.GameState.Play?[3,3]:[4,this.stopRolling("myRoll")];case 1:return e.sent(),[4,this.stopRolling("opponentRoll")];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.beginRolling=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.rolling[e]=!0,this.scheduleRoll(e),[2]})})},e.prototype.scheduleRoll=function(e){var t=this;this.rollingAnimationInterval[e]=setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.roll(e)];case 1:return[2,t.sent()]}})})},100+Math.floor(Math.random()*Math.floor(150)))},e.prototype.roll=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this[e]=this.generateRandomRoll(),this.rolling[e]&&this.scheduleRoll(e),[2]})})},e.prototype.stopRolling=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.rolling[e]=!1,clearTimeout(this.rollingAnimationInterval[e]),[2]})})},e.prototype.handleRoll=function(){return __awaiter(this,void 0,void 0,function(){var e,a,r,o,s,p,u,c,h,y,g;return __generator(this,function(m){switch(m.label){case 0:return this.appInstance.takeAction?[3,2]:(e=this,[4,this.cfProvider.getOrCreateAppInstance(this.appInstanceId,this.appInstance)]);case 1:e.appInstance=m.sent(),console.log("Reset appInstance",this.appInstance),m.label=2;case 2:return this.highRollerState.stage!==n.HighRollerStage.WAITING_FOR_P1_COMMITMENT?[3,5]:[4,this.beginRolling("myRoll")];case 3:return m.sent(),a=t.generateSalt(),r=1+Math.floor(Math.random()*Math.floor(1e3)),o=t.computeCommitHash(a,r),y={actionType:n.HighRollerActionType.COMMIT_TO_HASH,actionHash:o,number:0},s=this,u=(p=Object).assign,c=[{}],[4,this.appInstance.takeAction(y)];case 4:return s.highRollerState=u.apply(p,c.concat([m.sent(),{playerFirstNumber:l(r),salt:a}])),this.updateUIState({highRollerState:this.highRollerState}),[3,8];case 5:return this.highRollerState.stage!==n.HighRollerStage.P1_COMMITTED_TO_HASH?[3,8]:[4,this.beginRolling("myRoll")];case 6:return m.sent(),h=1+Math.floor(Math.random()*Math.floor(1e3)),g=this,[4,this.appInstance.takeAction(y={number:h,actionType:n.HighRollerActionType.COMMIT_TO_NUM,actionHash:i})];case 7:g.highRollerState=m.sent(),this.gameStatusLabel="Who will win?",m.label=8;case 8:return[2]}})})},e.prototype.handleRematch=function(){this.gameState=n.GameState.Play,this.highRollerState=this.defaultHighRollerState},e.prototype.handleExit=function(){window.location.assign("/")},e.prototype.render=function(){var e=this;return[o("div",{class:"wrapper"},o("div",{class:"game"},o("app-game-player",{playerName:this.opponent.attributes.username,playerScore:this.opponentScore,playerType:n.PlayerType.Black,playerRoll:this.opponentRoll}),o("app-game-status",{gameState:this.gameState,isProposing:this.isProposing,betAmount:this.betAmount,highRollerStage:this.highRollerState.stage,label:this.gameStatusLabel}),o("app-game-player",{playerName:"You",playerScore:this.myScore,playerType:n.PlayerType.White,playerRoll:this.myRoll}),o("div",{class:"actions"},this.gameState===n.GameState.Play?o("button",{class:"btn btn--center",onClick:function(){return e.handleRoll()}},"Roll your dice!"):o("button",{class:"btn btn--exit",onClick:function(){return e.handleExit()}},"Exit")))),this.gameState===n.GameState.Won?o("app-game-coins",null):void 0]},Object.defineProperty(e,"is",{get:function(){return"app-game"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{account:{type:"Any",attr:"account"},appInstance:{type:"Any",attr:"app-instance",mutable:!0},appInstanceId:{type:String,attr:"app-instance-id",mutable:!0},betAmount:{type:String,attr:"bet-amount",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state",mutable:!0,watchCallbacks:["onGameStateChanged"]},gameStatusLabel:{state:!0},generateRandomRoll:{type:"Any",attr:"generate-random-roll"},highRollerState:{type:"Any",attr:"high-roller-state",mutable:!0,watchCallbacks:["onHighRollerStateChanged"]},history:{type:"Any",attr:"history"},isProposing:{type:Boolean,attr:"is-proposing",mutable:!0},myRoll:{type:"Any",attr:"my-roll",mutable:!0},myScore:{type:Number,attr:"my-score",mutable:!0},opponent:{type:"Any",attr:"opponent"},opponentRoll:{type:"Any",attr:"opponent-roll",mutable:!0},opponentScore:{type:Number,attr:"opponent-score",mutable:!0},updateUIState:{type:"Any",attr:"update-u-i-state"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game:**/"},enumerable:!0,configurable:!0}),e}();n.CounterfactualTunnel.injectProps(s,["account","opponent","cfProvider","appInstance"]),r.HighRollerUITunnel.injectProps(s,["myRoll","myScore","opponentRoll","opponentScore","gameState","updateUIState","generateRandomRoll","highRollerState"]);var p=function(){function e(){this.playerType=n.PlayerType.Black,this.value=1}return e.prototype.render=function(){var e="./assets/images/dice/TYPE/0".replace(/TYPE/gi,this.playerType);return o("div",{class:"die__wrapper"},o("div",{class:"die__faces die__face-"+this.value},o("img",{src:e+"1.svg",class:"die__1 "+this.playerType,alt:""}),o("img",{src:e+"2.svg",class:"die__2 "+this.playerType,alt:""}),o("img",{src:e+"3.svg",class:"die__3 "+this.playerType,alt:""}),o("img",{src:e+"4.svg",class:"die__4 "+this.playerType,alt:""}),o("img",{src:e+"5.svg",class:"die__5 "+this.playerType,alt:""}),o("img",{src:e+"6.svg",class:"die__6 "+this.playerType,alt:""})))},Object.defineProperty(e,"is",{get:function(){return"app-game-die"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{playerType:{type:String,attr:"player-type"},value:{type:Number,attr:"value"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-die:**/"},enumerable:!0,configurable:!0}),e}(),u=function(){function e(){this.playerName="",this.playerScore=0,this.playerType=n.PlayerType.Black,this.playerRoll=[1,1]}return e.prototype.render=function(){return o("div",{class:"player"},o("div",{class:"player-info"},o("span",{class:"player-info__name "+this.playerType},this.playerName),o("div",{class:"player-info__status"},o("span",{class:"player-info__status__color "+this.playerType}),o("span",{class:"player-info__status__score"},this.playerScore))),o("div",{class:"player__dice"},o("app-game-die",{playerType:this.playerType,value:this.playerRoll[0]}),o("app-game-die",{playerType:this.playerType,value:this.playerRoll[1]})))},Object.defineProperty(e,"is",{get:function(){return"app-game-player"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{playerName:{type:String,attr:"player-name"},playerRoll:{type:"Any",attr:"player-roll"},playerScore:{type:Number,attr:"player-score"},playerType:{type:String,attr:"player-type"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-player:**/"},enumerable:!0,configurable:!0}),e}(),c=function(){function e(){this.el={},this.gameState=n.GameState.Play,this.highRollerStage=n.HighRollerStage.WAITING_FOR_P1_COMMITMENT,this.isProposing=!0,this.betAmount="0.01 ETH",this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.label=""}return Object.defineProperty(e.prototype,"gameStatusLabelForTurn",{get:function(){return this.label?this.label:this.highRollerStage===n.HighRollerStage.WAITING_FOR_P1_COMMITMENT||!this.isProposing&&this.highRollerStage===n.HighRollerStage.P1_COMMITTED_TO_HASH?"Your turn":this.opponent.attributes.username+"'s turn"},enumerable:!0,configurable:!0}),e.prototype.render=function(){return o("div",{class:"divider"},this.gameState===n.GameState.Play?o("div",{class:"divider__status divider__status--turn"},this.gameStatusLabelForTurn):this.gameState===n.GameState.Won?o("div",{class:"divider__status divider__status--won"},o("span",{class:"result"},"You Won!"),o("span",{class:"reward"},this.betAmount)):this.gameState===n.GameState.Lost?o("div",{class:"divider__status divider__status--lost"},o("span",{class:"result"},"You Lost!"),o("span",{class:"reward"},this.betAmount)):o("div",{class:"divider__status divider__status--turn"},"It's a tie!"))},Object.defineProperty(e,"is",{get:function(){return"app-game-status"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{account:{type:"Any",attr:"account"},betAmount:{type:String,attr:"bet-amount"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state"},highRollerStage:{type:Number,attr:"high-roller-stage"},isProposing:{type:Boolean,attr:"is-proposing"},label:{type:String,attr:"label"},opponent:{type:"Any",attr:"opponent"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-status:**/"},enumerable:!0,configurable:!0}),e}();n.CounterfactualTunnel.injectProps(c,["account","opponent"]),e.AppGame=s,e.AppGameDie=p,e.AppGamePlayer=u,e.AppGameStatus=c,Object.defineProperty(e,"__esModule",{value:!0})});
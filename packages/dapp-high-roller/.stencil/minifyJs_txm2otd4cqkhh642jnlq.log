var __awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};App.loadBundle("/**:bundle-id:**/",["exports","./chunk-346f9d40.js","./chunk-48936b03.js","./chunk-b4eb213b.js","./chunk-650041b1.js"],function(t,e,n,o,r){var i,a=window.App.h;!function(t){(t.ErrorType||(t.ErrorType={})).ERROR="error",function(t){t.GET_APP_INSTANCES="getAppInstances",t.GET_PROPOSED_APP_INSTANCES="getProposedAppInstances",t.PROPOSE_INSTALL="proposeInstall",t.PROPOSE_INSTALL_VIRTUAL="proposeInstallVirtual",t.REJECT_INSTALL="rejectInstall",t.INSTALL="install",t.INSTALL_VIRTUAL="installVirtual",t.GET_STATE="getState",t.GET_APP_INSTANCE_DETAILS="getAppInstanceDetails",t.TAKE_ACTION="takeAction",t.UNINSTALL="uninstall",t.UNINSTALL_VIRTUAL="uninstallVirtual",t.PROPOSE_STATE="proposeState",t.ACCEPT_STATE="acceptState",t.REJECT_STATE="rejectState",t.CREATE_MULTISIG="createMultisig",t.GET_CHANNEL_ADDRESSES="getChannelAddresses",t.MATCHMAKE="matchmake"}(t.MethodName||(t.MethodName={})),function(t){t.INSTALL="installEvent",t.REJECT_INSTALL="rejectInstallEvent",t.UPDATE_STATE="updateStateEvent",t.UNINSTALL="uninstallEvent",t.PROPOSE_STATE="proposeStateEvent",t.REJECT_STATE="rejectStateEvent",t.CREATE_MULTISIG="createMultisigEvent",t.MATCH_MADE="matchmade"}(t.EventName||(t.EventName={}))}(i||(i={}));var s=function(){function t(){this.isConnected=!1,this.callback=function(){}}return t.prototype.onMessage=function(t){this.callback=t},t.prototype.sendMessage=function(t){if(!this.isConnected)throw new Error("It's not possible to use postMessage() before the NodeProvider is connected. Call the connect() method first.");var e="app-instance-"+(new Date).valueOf();switch(t.type){case i.MethodName.PROPOSE_INSTALL_VIRTUAL:this.sendCallback({type:i.MethodName.PROPOSE_INSTALL_VIRTUAL,result:{appInstanceId:e},requestId:t.requestId},100),this.sendCallback({type:i.EventName.INSTALL,data:{appInstanceId:e}},5e3);break;case i.MethodName.GET_APP_INSTANCE_DETAILS:this.sendCallback({type:i.MethodName.GET_APP_INSTANCE_DETAILS,result:{appInstance:{id:t.params.appInstanceId}},requestId:t.requestId},1);break;default:console.error("Unhandled message in MockNodeProvider:",t)}},t.prototype.sendCallback=function(t,e){var n=this;setTimeout(function(){n.callback(t)},e)},t.prototype.connect=function(){return d(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this.isConnected?(console.warn("NodeProvider is already connected."),[2,Promise.resolve(this)]):[2,new Promise(function(e,n){return setTimeout(function(){return t.isConnected=!0,e(t)},1e3)})]})})},t}(),c=ethers.utils.bigNumberify,u=function(){function t(){var t=this;this.el={},this.history={},this.updateAppInstance=function(){},this.updateAppFactory=function(){},this.updateCfProvider=function(){},this.updateIntermediary=function(){},this.updateUIState=function(){},this.goToGame=function(){},this.highRoller=function(){return d(t,void 0,void 0,function(){return __generator(this,function(t){return[2,{playerFirstRoll:[0,0],playerSecondRoll:[0,0]}]})})},this.generateRandomRoll=function(){return[0,0]},this.highRollerState={},this.gameState=n.GameState.Play,this.myRoll=[1,1],this.myScore=0,this.opponentRoll=[1,1],this.opponentScore=0,this.nodeProvider={},this.cfProvider={},this.appFactory={},this.appInstance={},this.intermediary=""}return t.prototype.componentWillLoad=function(){return d(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=new URLSearchParams(window.location.search),this.nodeProvider=t.get("standalone")?new s:new cf.NodeProvider,[4,this.nodeProvider.connect()];case 1:return e.sent(),this.setupCfProvider(),[2]}})})},t.prototype.setupCfProvider=function(){this.cfProvider=new cf.Provider(this.nodeProvider),this.cfProvider.on("chan_updateState",this.onUpdateState.bind(this)),this.cfProvider.on("chan_uninstall",this.onUninstall.bind(this)),this.cfProvider.on("chan_installVirtual",this.onInstall.bind(this)),this.appFactory=new cf.AppFactory("0x144F1A5C2db59B58f2c73d09A2acb27a57E47618",{actionEncoding:"tuple(uint8 actionType, uint256 number, bytes32 actionHash)",stateEncoding:"\n          tuple(\n            uint8 stage,\n            bytes32 salt,\n            bytes32 commitHash,\n            uint256 playerFirstNumber,\n            uint256 playerSecondNumber,\n            uint256 versionNumber\n          )\n        "},this.cfProvider),this.updateAppFactory(this.appFactory),this.updateCfProvider(this.cfProvider)},t.prototype.isReadyForHighRoller=function(t){return c(t.playerFirstNumber).toNumber()&&c(t.playerSecondNumber).toNumber()&&t.stage===n.HighRollerStage.P1_REVEALED_NUM},t.prototype.onUpdateState=function(t){var e=t.data;return d(this,void 0,void 0,function(){var t,o,r,i,a,s,c,u,p,l;return __generator(this,function(h){switch(h.label){case 0:return t=e.newState,o=Object.assign({},t,{playerFirstNumber:this.highRollerState.playerFirstNumber||t.playerFirstNumber}),console.log("playerFirstNumber",o.playerFirstNumber,"playerSecondNumber",o.playerSecondNumber),o.stage!==n.HighRollerStage.P2_COMMITTED_TO_NUM?[3,2]:[4,this.appInstance.takeAction({actionType:n.HighRollerActionType.REVEAL_NUM,actionHash:this.highRollerState.salt,number:o.playerFirstNumber})];case 1:return[2,h.sent()];case 2:return this.isReadyForHighRoller(o)?(r=this.myScore,i=this.opponentScore,[4,this.highRoller(o.playerFirstNumber,o.playerSecondNumber)]):(this.updateUIState({highRollerState:o}),[2]);case 3:return s=h.sent(),(p=(c=s.playerSecondRoll)[0]+c[1])>(l=(u=s.playerFirstRoll)[0]+u[1])?(r=this.myScore+1,a=n.GameState.Won):p<l?(i+=1,a=n.GameState.Lost):a=n.GameState.Tie,this.updateUIState({myRoll:c,opponentRoll:u,myScore:r,opponentScore:i,gameState:a,highRollerState:o}),o.stage!==n.HighRollerStage.P1_REVEALED_NUM?[3,5]:[4,this.appInstance.uninstall(this.intermediary)];case 4:h.sent(),h.label=5;case 5:return[2]}})})},t.prototype.onInstall=function(t){this.updateAppInstance(t.data.appInstance),this.goToGame(this.history)},t.prototype.onUninstall=function(t){},t.prototype.render=function(){return a("slot",null)},Object.defineProperty(t,"is",{get:function(){return"app-provider"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{appFactory:{type:"Any",attr:"app-factory",mutable:!0},appInstance:{type:"Any",attr:"app-instance",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider",mutable:!0},el:{elementRef:!0},gameState:{type:Number,attr:"game-state"},generateRandomRoll:{type:"Any",attr:"generate-random-roll"},goToGame:{type:"Any",attr:"go-to-game"},highRoller:{type:"Any",attr:"high-roller"},highRollerState:{type:"Any",attr:"high-roller-state"},history:{type:"Any",attr:"history"},intermediary:{type:String,attr:"intermediary"},myRoll:{type:"Any",attr:"my-roll"},myScore:{type:Number,attr:"my-score"},nodeProvider:{type:"Any",attr:"node-provider",mutable:!0},opponentRoll:{type:"Any",attr:"opponent-roll"},opponentScore:{type:Number,attr:"opponent-score"},updateAppFactory:{type:"Any",attr:"update-app-factory"},updateAppInstance:{type:"Any",attr:"update-app-instance"},updateCfProvider:{type:"Any",attr:"update-cf-provider"},updateIntermediary:{type:"Any",attr:"update-intermediary"},updateUIState:{type:"Any",attr:"update-u-i-state"}}},enumerable:!0,configurable:!0}),t}();o.HighRollerUITunnel.injectProps(u,["myRoll","myScore","opponentRoll","opponentScore","gameState","updateUIState","highRollerState"]),n.CounterfactualTunnel.injectProps(u,["appInstance","intermediary"]);var p=ethers.utils.solidityKeccak256,l=ethers.constants.HashZero,h=function(){function t(){this.userDataReceived=!1,this.history={};var t=new URLSearchParams(window.location.search);this.state={account:{},opponent:{},standalone:"true"===t.get("standalone")||!1,appInstance:null,appFactory:null,cfProvider:null,intermediary:null,updateAppInstance:this.updateAppInstance.bind(this),updateAppFactory:this.updateAppFactory.bind(this),updateUser:this.updateAccount.bind(this),updateOpponent:this.updateOpponent.bind(this),updateCfProvider:this.updateCfProvider.bind(this),updateIntermediary:this.updateIntermediary.bind(this)},this.uiState={myRoll:[0,0],myScore:0,opponentRoll:[0,0],opponentScore:0,gameState:n.GameState.Play,updateUIState:this.updateUIState.bind(this),highRoller:this.highRoller.bind(this),generateRandomRoll:this.generateRandomRoll.bind(this),highRollerState:{stage:n.HighRollerStage.WAITING_FOR_P1_COMMITMENT,salt:l,commitHash:l,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0}},window.addEventListener("popstate",function(){window.parent.postMessage("playground:send:dappRoute|"+location.hash,"*")})}return t.prototype.setupPlaygroundMessageListeners=function(){var t=this;window.addEventListener("message",function(e){return d(t,void 0,void 0,function(){var t,n,o,r,i;return __generator(this,function(a){return"string"==typeof e.data&&e.data.startsWith("playground:response:user")&&(t=e.data.split("|"),r=t[1],n=JSON.parse(r),this.updateAccount(n),this.userDataReceived=!0),"string"==typeof e.data&&e.data.startsWith("playground:response:appInstance")&&(o=e.data.split("|"),(r=o[1])&&(console.log("Received playground appInstance: ",r),i=JSON.parse(r).appInstance,this.updateAppInstance(i),this.updateOpponent({attributes:{nodeAddress:this.state.appInstance.initialState.initiatorAddress}}),this.goToWaitingRoom(this.history))),[2]})})})},t.prototype.componentWillLoad=function(){return d(this,void 0,void 0,function(){return __generator(this,function(t){return this.setupPlaygroundMessageListeners(),[2]})})},t.prototype.componentDidLoad=function(){return d(this,void 0,void 0,function(){return __generator(this,function(t){return window.parent.postMessage("playground:request:user","*"),this.state.standalone&&(this.updateAccount({user:{address:"0xc60b9023bb8dc153b4046977328ce79af12a77e0",email:"alon2@example.com",id:"687297bc-8014-4c82-8cee-3b7ca7db09d4",username:"MyName"},multisigAddress:"0x9499ac5A66c36447e535d252c049304D80961CED"}),this.userDataReceived=!0),[2]})})},t.prototype.receiveRouterHistory=function(t){this.history=t},t.prototype.updateAccount=function(t){this.state=Object.assign({},this.state,{account:t}),ga("set","userId",t.user.id)},t.prototype.updateOpponent=function(t){this.state=Object.assign({},this.state,{opponent:t})},t.prototype.updateAppInstance=function(t){this.state=Object.assign({},this.state,{appInstance:t}),console.log("appInstance updated",t)},t.prototype.updateAppFactory=function(t){this.state=Object.assign({},this.state,{appFactory:t})},t.prototype.updateCfProvider=function(t){this.state=Object.assign({},this.state,{cfProvider:t}),console.log("CFProvider instance updated")},t.prototype.updateIntermediary=function(t){this.state=Object.assign({},this.state,{intermediary:t})},t.prototype.updateUIState=function(t){this.uiState=Object.assign({},this.uiState,t),console.log("%cNew UI state detected","font-size: 14px; color: red"),console.log("    ",this.uiState)},t.prototype.generateRandomRoll=function(){return[1+Math.floor(Math.random()*Math.floor(6)),1+Math.floor(Math.random()*Math.floor(6))]},t.prototype.highRoller=function(t,e){return d(this,void 0,void 0,function(){var n,o,r,i;return __generator(this,function(a){switch(a.label){case 0:return n=p(["uint256"],[t.mul(e)]),o=["\n      function highRoller(bytes32 randomness)\n        public\n        pure\n        returns(uint8 playerFirstTotal, uint8 playerSecondTotal)\n    "],r=new ethers.providers.Web3Provider(web3.currentProvider),[4,new ethers.Contract("0x144F1A5C2db59B58f2c73d09A2acb27a57E47618",o,r).highRoller(n)];case 1:return i=a.sent(),[2,{playerFirstRoll:this.getDieNumbers(i[0]),playerSecondRoll:this.getDieNumbers(i[1])}]}})})},t.prototype.getDieNumbers=function(t){return 12===t?[6,6]:t>2&&t<12?[Math.floor(t/2),Math.ceil(t/2)]:t>2&&t%2==0?[Math.floor(t/2)-1,Math.ceil(t/2)+1]:[t/2,t/2]},t.prototype.goToGame=function(t,e){void 0===e&&(e=!0),t.push({pathname:"/game",state:{isProposing:e,betAmount:ethers.utils.formatEther(this.state.appInstance.initiatorDeposit)},query:{},key:""})},t.prototype.goToWaitingRoom=function(t){t.push("/waiting",{isProposing:!1,betAmount:ethers.utils.formatEther(this.state.appInstance.responderDeposit)})},t.prototype.render=function(){return this.userDataReceived?a("div",{class:"height-100"},a("main",{class:"height-100"},a(n.CounterfactualTunnel.Provider,{state:this.state},a(o.HighRollerUITunnel.Provider,{state:this.uiState},a("stencil-router",{historyType:"hash"},a("stencil-route-switch",{scrollTopOffset:0},a("app-provider",{updateAppInstance:this.state.updateAppInstance.bind(this),updateAppFactory:this.state.updateAppFactory.bind(this),updateCfProvider:this.state.updateCfProvider.bind(this),updateIntermediary:this.state.updateIntermediary.bind(this),updateUIState:this.uiState.updateUIState.bind(this),highRoller:this.uiState.highRoller.bind(this),generateRandomRoll:this.uiState.generateRandomRoll.bind(this),goToGame:this.goToGame.bind(this),history:this.history},a("stencil-route",{url:"/",exact:!0,component:"app-logo",componentProps:{cfProvider:this.state.cfProvider,appInstance:this.state.appInstance,goToWaitingRoom:this.goToWaitingRoom,updateAppInstance:this.updateAppInstance,provideRouterHistory:this.receiveRouterHistory.bind(this)}}),a("stencil-route",{url:"/wager",component:"app-wager",componentProps:{updateOpponent:this.state.updateOpponent}}),a("stencil-route",{url:"/game",component:"app-game"}),a("stencil-route",{url:"/waiting",component:"app-waiting",componentProps:{cfProvider:this.state.cfProvider,appInstance:this.state.appInstance,goToWaitingRoom:this.goToWaitingRoom,updateAppInstance:this.updateAppInstance,history:this.history}}),a("stencil-route",{url:"/accept-invite",component:"app-accept-invite"})))))))):a("h1",{class:"App message"},"connecting....")},Object.defineProperty(t,"is",{get:function(){return"app-root"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{history:{state:!0},state:{type:"Any",attr:"state",mutable:!0},uiState:{type:"Any",attr:"ui-state",mutable:!0},userDataReceived:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"/**style-placeholder:app-root:**/"},enumerable:!0,configurable:!0}),t}(),d=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((o=o.apply(t,e||[])).next())})},f=function(){function t(){this.group=null,this.match=null,this.componentProps={},this.exact=!1,this.scrollOnNextRender=!1,this.previousMatch=null}return t.prototype.computeMatch=function(t){var e=null!=this.group||null!=this.el.parentElement&&"stencil-route-switch"===this.el.parentElement.tagName.toLowerCase();if(t&&!e)return this.previousMatch=this.match,this.match=r.matchPath(t.pathname,{path:this.url,exact:this.exact,strict:!0})},t.prototype.loadCompleted=function(){return d(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t={},this.history&&this.history.location.hash?t={scrollToId:this.history.location.hash.substr(1)}:this.scrollTopOffset&&(t={scrollTopOffset:this.scrollTopOffset}),"function"==typeof this.componentUpdated?this.componentUpdated(t):this.match&&!r.matchesAreEqual(this.match,this.previousMatch)&&this.routeViewsUpdated&&this.routeViewsUpdated(t),[2]})})},t.prototype.componentDidUpdate=function(){return d(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadCompleted()];case 1:return t.sent(),[2]}})})},t.prototype.componentDidLoad=function(){return d(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadCompleted()];case 1:return t.sent(),[2]}})})},t.prototype.render=function(){if(!this.match||!this.history)return null;var t=Object.assign({},this.componentProps,{history:this.history,match:this.match});return this.routeRender?this.routeRender(Object.assign({},t,{component:this.component})):this.component?a(this.component,Object.assign({},t)):void 0},Object.defineProperty(t,"is",{get:function(){return"stencil-route"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{component:{type:String,attr:"component"},componentProps:{type:"Any",attr:"component-props"},componentUpdated:{type:"Any",attr:"component-updated"},el:{elementRef:!0},exact:{type:Boolean,attr:"exact"},group:{type:String,attr:"group",reflectToAttr:!0},history:{type:"Any",attr:"history"},historyType:{type:String,attr:"history-type"},location:{type:"Any",attr:"location",watchCallbacks:["computeMatch"]},match:{type:"Any",attr:"match",mutable:!0},routeRender:{type:"Any",attr:"route-render"},routeViewsUpdated:{type:"Any",attr:"route-views-updated"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"},url:{type:String,attr:"url"}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"/**style-placeholder:stencil-route:**/"},enumerable:!0,configurable:!0}),t}();r.ActiveRouter.injectProps(f,["location","history","historyType","routeViewsUpdated"]);function y(t){return"stencil-route"===t.tagName.toLowerCase()}var g=function(){function t(){this.group=window.crypto?([1e7].toString()+-1e3.toString()+-4e3.toString()+-8e3.toString()+-1e11.toString()).replace(/[018]/g,function(t){return(t^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):((1e17*Math.random()).toString().match(/.{4}/g)||[]).join("-"),this.subscribers=[]}return t.prototype.componentWillLoad=function(){null!=this.location&&this.regenerateSubscribers(this.location)},t.prototype.regenerateSubscribers=function(t){return e=this,n=void 0,i=function(){var e,n,o=this;return __generator(this,function(i){return null==t?[2]:(e=-1,this.subscribers=Array.prototype.slice.call(this.el.children).filter(y).map(function(n,o){var i=r.matchPath(t.pathname,{path:n.url,exact:n.exact,strict:!0});return i&&-1===e&&(e=o),{el:n,match:i}}),-1===e?[2]:this.activeIndex===e?(this.subscribers[e].el.match=this.subscribers[e].match,[2]):(this.activeIndex=e,n=this.subscribers[this.activeIndex],this.scrollTopOffset&&(n.el.scrollTopOffset=this.scrollTopOffset),n.el.group=this.group,n.el.match=n.match,n.el.componentUpdated=function(t){o.queue.write(function(){o.subscribers.forEach(function(t,e){if(t.el.componentUpdated=void 0,e===o.activeIndex)return t.el.style.display="";o.scrollTopOffset&&(t.el.scrollTopOffset=o.scrollTopOffset),t.el.group=o.group,t.el.match=null,t.el.style.display="none"})}),o.routeViewsUpdated&&o.routeViewsUpdated(Object.assign({scrollTopOffset:o.scrollTopOffset},t))},[2]))})},new((o=void 0)||(o=Promise))(function(t,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(e){e.done?t(e.value):new o(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,n||[])).next())});var e,n,o,i},t.prototype.render=function(){return a("slot",null)},Object.defineProperty(t,"is",{get:function(){return"stencil-route-switch"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{el:{elementRef:!0},group:{type:String,attr:"group",reflectToAttr:!0},location:{type:"Any",attr:"location",watchCallbacks:["regenerateSubscribers"]},queue:{context:"queue"},routeViewsUpdated:{type:"Any",attr:"route-views-updated"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"}}},enumerable:!0,configurable:!0}),t}();function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t||console.error.apply(console,e)}function v(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t||console.warn.apply(console,e)}r.ActiveRouter.injectProps(g,["location","routeViewsUpdated"]);var b=function(){var t,e=[];return{setPrompt:function(e){return v(null==t,"A history supports only one prompt at a time"),t=e,function(){t===e&&(t=null)}},confirmTransitionTo:function(e,n,o,r){if(null!=t){var i="function"==typeof t?t(e,n):t;"string"==typeof i?"function"==typeof o?o(i,r):(v(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),r(!0)):r(!1!==i)}else r(!0)},appendListener:function(t){var n=!0,o=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];n&&t.apply(void 0,e)};return e.push(o),function(){n=!1,e=e.filter(function(t){return t!==o})}},notifyListeners:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.forEach(function(e){return e.apply(void 0,t)})}}},S=function(t){void 0===t&&(t="scrollPositions");var e=new Map;if(r.storageAvailable("sessionStorage")){var n=window.sessionStorage.getItem(t);e=n?new Map(JSON.parse(n)):e}function o(t,n){if(e.set(t,n),r.storageAvailable("sessionStorage")){var o=[];e.forEach(function(t,e){o.push([e,t])}),window.sessionStorage.setItem("scrollPositions",JSON.stringify(o))}}return"scrollRestoration"in history&&(history.scrollRestoration="manual"),{set:o,get:function(t){return e.get(t)},has:function(t){return e.has(t)},capture:function(t){o(t,[window.scrollX,window.scrollY])}}},w=function(){try{return window.history.state||{}}catch(t){return{}}},P={hashbang:{encodePath:function(t){return"!"===t.charAt(0)?t:"!/"+r.stripLeadingSlash(t)},decodePath:function(t){return"!"===t.charAt(0)?t.substr(1):t}},noslash:{encodePath:r.stripLeadingSlash,decodePath:r.addLeadingSlash},slash:{encodePath:r.addLeadingSlash,decodePath:r.addLeadingSlash}},A=function(){var t=window.location.href,e=t.indexOf("#");return-1===e?"":t.substring(e+1)},T=function(t){var e=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,e>=0?e:0)+"#"+t)};function R(t,e){var n=0==t.pathname.indexOf(e)?"/"+t.pathname.slice(e.length):t.pathname;return Object.assign({},t,{pathname:n})}var I={browser:function(t){void 0===t&&(t={}),m(r.canUseDOM,"Browser history needs a DOM");var e=window.history,n=r.supportsHistory(),o=!r.supportsPopStateOnHashChange(),i=S(),a=null!=t.forceRefresh&&t.forceRefresh,s=null!=t.getUserConfirmation?t.getUserConfirmation:r.getConfirmation,c=null!=t.keyLength?t.keyLength:6,u=t.basename?r.stripTrailingSlash(r.addLeadingSlash(t.basename)):"",p=function(t){var e=(t=t||{}).key,n=t.state,o=window.location,i=o.pathname+o.search+o.hash;return v(!u||r.hasBasename(i,u),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+i+'" to begin with "'+u+'".'),u&&(i=r.stripBasename(i,u)),r.createLocation(i,n,e||r.createKey(c))},l=b(),h=function(t){i.capture(_.location.key),Object.assign(_,t),_.location.scrollPosition=i.get(_.location.key),_.length=e.length,l.notifyListeners(_.location,_.action)},d=function(t){r.isExtraneousPopstateEvent(t)||g(p(t.state))},f=function(){g(p(w()))},y=!1,g=function(t){y?(y=!1,h()):l.confirmTransitionTo(t,"POP",s,function(e){e?h({action:"POP",location:t}):P(t)})},P=function(t){var e=T.indexOf(_.location.key);-1===e&&(e=0);var n=T.indexOf(t.key);-1===n&&(n=0);var o=e-n;o&&(y=!0,I(o))},A=p(w()),T=[A.key],R=function(t){return u+r.createPath(t)},I=function(t){e.go(t)},E=0,O=function(t){1===(E+=t)?(r.addEventListener(window,"popstate",d),o&&r.addEventListener(window,"hashchange",f)):0===E&&(r.removeEventListener(window,"popstate",d),o&&r.removeEventListener(window,"hashchange",f))},L=!1,_={length:e.length,action:"POP",location:A,createHref:R,push:function(t,o){v(!("object"==typeof t&&void 0!==t.state&&void 0!==o),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var i=r.createLocation(t,o,r.createKey(c),_.location);l.confirmTransitionTo(i,"PUSH",s,function(t){if(t){var o=R(i),r=i.state;if(n)if(e.pushState({key:i.key,state:r},void 0,o),a)window.location.href=o;else{var s=T.indexOf(_.location.key),c=T.slice(0,-1===s?0:s+1);c.push(i.key),T=c,h({action:"PUSH",location:i})}else v(void 0===r,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=o}})},replace:function(t,o){v(!("object"==typeof t&&void 0!==t.state&&void 0!==o),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var i=r.createLocation(t,o,r.createKey(c),_.location);l.confirmTransitionTo(i,"REPLACE",s,function(t){if(t){var o=R(i),r=i.state;if(n)if(e.replaceState({key:i.key,state:r},void 0,o),a)window.location.replace(o);else{var s=T.indexOf(_.location.key);-1!==s&&(T[s]=i.key),h({action:"REPLACE",location:i})}else v(void 0===r,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(o)}})},go:I,goBack:function(){return I(-1)},goForward:function(){return I(1)},block:function(t){void 0===t&&(t="");var e=l.setPrompt(t);return L||(O(1),L=!0),function(){return L&&(L=!1,O(-1)),e()}},listen:function(t){var e=l.appendListener(t);return O(1),function(){O(-1),e()}}};return _},hash:function(t){void 0===t&&(t={}),m(r.canUseDOM,"Hash history needs a DOM");var e=window.history,n=r.supportsGoWithoutReloadUsingHash(),o=null!=t.keyLength?t.keyLength:6,i=t.getUserConfirmation,a=void 0===i?r.getConfirmation:i,s=t.hashType,c=void 0===s?"slash":s,u=t.basename?r.stripTrailingSlash(r.addLeadingSlash(t.basename)):"",p=P[c],l=p.encodePath,h=p.decodePath,d=function(){var t=h(A());return v(!u||r.hasBasename(t,u),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+t+'" to begin with "'+u+'".'),u&&(t=r.stripBasename(t,u)),r.createLocation(t,void 0,r.createKey(o))},f=b(),y=function(t){Object.assign(x,t),x.length=e.length,f.notifyListeners(x.location,x.action)},g=!1,S=null,w=function(){var t=A(),e=l(t);if(t!==e)T(e);else{var n=d();if(!g&&r.locationsAreEqual(x.location,n))return;if(S===r.createPath(n))return;S=null,R(n)}},R=function(t){g?(g=!1,y()):f.confirmTransitionTo(t,"POP",a,function(e){e?y({action:"POP",location:t}):I(t)})},I=function(t){var e=_.lastIndexOf(r.createPath(x.location));-1===e&&(e=0);var n=_.lastIndexOf(r.createPath(t));-1===n&&(n=0);var o=e-n;o&&(g=!0,N(o))},E=A(),O=l(E);E!==O&&T(O);var L=d(),_=[r.createPath(L)],N=function(t){v(n,"Hash history go(n) causes a full page reload in this browser"),e.go(t)},U=0,C=function(t){1===(U+=t)?r.addEventListener(window,"hashchange",w):0===U&&r.removeEventListener(window,"hashchange",w)},M=!1,x={length:e.length,action:"POP",location:L,createHref:function(t){return"#"+l(u+r.createPath(t))},push:function(t,e){v(void 0===e,"Hash history cannot push state; it is ignored");var n=r.createLocation(t,void 0,r.createKey(o),x.location);f.confirmTransitionTo(n,"PUSH",a,function(t){if(t){var e=r.createPath(n),o=l(u+e);if(A()!==o){S=e,window.location.hash=o;var i=_.lastIndexOf(r.createPath(x.location)),a=_.slice(0,-1===i?0:i+1);a.push(e),_=a,y({action:"PUSH",location:n})}else v(!1,"Hash history cannot PUSH the same path; a new entry will not be added to the history stack"),y()}})},replace:function(t,e){v(void 0===e,"Hash history cannot replace state; it is ignored");var n=r.createLocation(t,void 0,r.createKey(o),x.location);f.confirmTransitionTo(n,"REPLACE",a,function(t){if(t){var e=r.createPath(n),o=l(u+e);A()!==o&&(S=e,T(o));var i=_.indexOf(r.createPath(x.location));-1!==i&&(_[i]=e),y({action:"REPLACE",location:n})}})},go:N,goBack:function(){return N(-1)},goForward:function(){return N(1)},block:function(t){void 0===t&&(t="");var e=f.setPrompt(t);return M||(C(1),M=!0),function(){return M&&(M=!1,C(-1)),e()}},listen:function(t){var e=f.appendListener(t);return C(1),function(){C(-1),e()}}};return x}},E=function(){function t(){var t=this;this.root="/",this.historyType="browser",this.titleSuffix="",this.routeViewsUpdated=function(e){if(void 0===e&&(e={}),e.scrollToId&&"browser"===t.historyType){var n=document.getElementById(e.scrollToId);if(n)return n.scrollIntoView()}t.scrollTo(e.scrollTopOffset||t.scrollTopOffset)}}return t.prototype.componentWillLoad=function(){var t=this;this.history=I[this.historyType](),this.history.listen(function(e){return n=t,o=void 0,i=function(){return __generator(this,function(t){return e=R(e,this.root),this.location=e,[2]})},new((r=void 0)||(r=Promise))(function(t,e){function a(t){try{c(i.next(t))}catch(t){e(t)}}function s(t){try{c(i.throw(t))}catch(t){e(t)}}function c(e){e.done?t(e.value):new r(function(t){t(e.value)}).then(a,s)}c((i=i.apply(n,o||[])).next())});var n,o,r,i}),this.location=R(this.history.location,this.root)},t.prototype.scrollTo=function(t){var e=this;if(null!=t&&!this.isServer&&this.history)return"POP"===this.history.action&&Array.isArray(this.history.location.scrollPosition)?this.queue.write(function(){e.history&&e.history.location&&Array.isArray(e.history.location.scrollPosition)&&window.scrollTo(e.history.location.scrollPosition[0],e.history.location.scrollPosition[1])}):this.queue.write(function(){window.scrollTo(0,t)})},t.prototype.render=function(){if(this.location&&this.history)return a(r.ActiveRouter.Provider,{state:{historyType:this.historyType,location:this.location,titleSuffix:this.titleSuffix,root:this.root,history:this.history,routeViewsUpdated:this.routeViewsUpdated}},a("slot",null))},Object.defineProperty(t,"is",{get:function(){return"stencil-router"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{history:{state:!0},historyType:{type:String,attr:"history-type"},isServer:{context:"isServer"},location:{state:!0},queue:{context:"queue"},root:{type:String,attr:"root"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"},titleSuffix:{type:String,attr:"title-suffix"}}},enumerable:!0,configurable:!0}),t}();t.AppProvider=u,t.AppRoot=h,t.StencilRoute=f,t.StencilRouteSwitch=g,t.StencilRouter=E,Object.defineProperty(t,"__esModule",{value:!0})});
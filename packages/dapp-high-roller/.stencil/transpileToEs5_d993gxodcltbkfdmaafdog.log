import * as tslib_1 from "tslib";
import { h } from '../app.core.js';
var AppGameCoin = /** @class */ (function () {
    function AppGameCoin() {
        this.coins = [];
        this.delay = 0;
        this.speed = 0;
        this.x = 0;
        this.index = 0;
        this.animating = true;
        this.set = Math.floor(Math.random() * 3);
        this.index = Math.floor(Math.random() * 3);
    }
    AppGameCoin.prototype.componentWillLoad = function () {
        this.switchImage();
    };
    AppGameCoin.prototype.componentDidUnload = function () {
        this.animating = false;
    };
    AppGameCoin.prototype.switchImage = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new Promise(function (resolve) { return setTimeout(resolve, 100 + Math.floor(Math.random() * 150)); })];
                    case 1:
                        _a.sent();
                        this.index += 1;
                        if (this.index >= Object.keys(this.coins[this.set]).length)
                            this.index = 0;
                        if (this.animating)
                            this.switchImage();
                        return [2 /*return*/];
                }
            });
        });
    };
    AppGameCoin.prototype.render = function () {
        return (h("img", { class: "coin", src: this.coins[this.set][this.index], style: {
                left: this.x + "%",
                animationDelay: this.delay + "s",
                animationDuration: this.speed + "s"
            } }));
    };
    Object.defineProperty(AppGameCoin, "is", {
        get: function () { return "app-game-coin"; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoin, "encapsulation", {
        get: function () { return "shadow"; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoin, "properties", {
        get: function () {
            return {
                "coins": {
                    "type": "Any",
                    "attr": "coins"
                },
                "delay": {
                    "type": Number,
                    "attr": "delay"
                },
                "index": {
                    "state": true
                },
                "speed": {
                    "type": Number,
                    "attr": "speed"
                },
                "x": {
                    "type": Number,
                    "attr": "x"
                }
            };
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoin, "style", {
        get: function () { return "/**style-placeholder:app-game-coin:**/"; },
        enumerable: true,
        configurable: true
    });
    return AppGameCoin;
}());
var AppGameCoins = /** @class */ (function () {
    function AppGameCoins() {
        this.preloadCoins();
    }
    AppGameCoins.prototype.preloadCoins = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = this;
                        return [4 /*yield*/, Promise.all([
                                ["02", "11", "12", "06"],
                                ["10", "07", "04", "07"],
                                ["03", "09", "08", "02"]
                            ].map(function (set) {
                                return Promise.all(set.map(function (number) {
                                    return new Promise(function (resolve) {
                                        var img = new Image();
                                        var c = document.createElement("canvas");
                                        var ctx = c.getContext("2d") || new CanvasRenderingContext2D();
                                        img.onload = function () {
                                            c.width = img.naturalWidth;
                                            c.height = img.naturalHeight;
                                            ctx.drawImage(img, 0, 0);
                                            resolve(c.toDataURL("image/png"));
                                        };
                                        img.src = "./assets/images/coins/" + number + ".png";
                                    });
                                }));
                            }))];
                    case 1:
                        _a.coins = _b.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    AppGameCoins.prototype.render = function () {
        var _this = this;
        var length = Math.min(50, Math.max(20, (screen.width * screen.height) / 10000));
        return this.coins ? (h("div", { class: "coins" }, Array.from({ length: length }).map(function () { return (h("div", { class: "coins__coin" }, h("app-game-coin", { coins: _this.coins, delay: Math.random() * 3, speed: 1.5 + Math.random() * 1, x: -20 + Math.random() * 120 }))); }))) : (undefined);
    };
    Object.defineProperty(AppGameCoins, "is", {
        get: function () { return "app-game-coins"; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoins, "encapsulation", {
        get: function () { return "shadow"; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoins, "properties", {
        get: function () {
            return {
                "coins": {
                    "state": true
                }
            };
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppGameCoins, "style", {
        get: function () { return "/**style-placeholder:app-game-coins:**/"; },
        enumerable: true,
        configurable: true
    });
    return AppGameCoins;
}());
export { AppGameCoin, AppGameCoins };

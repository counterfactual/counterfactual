import*as tslib_1 from"../polyfills/tslib.js";import{h}from"../app.core.js";import{a as getProp,b as generateSalt,c as computeCommitHash}from"./chunk-960e9c51.js";import"./chunk-deed3e85.js";import{b as HighRollerStage,a as GameState,c as HighRollerActionType,d as PlayerType,e as CounterfactualTunnel}from"./chunk-a0cc8100.js";import{a as HighRollerUITunnel}from"./chunk-91bb08fc.js";var HashZero=ethers.constants.HashZero,bigNumberify=ethers.utils.bigNumberify,AppGame=function(){function e(){this.el={},this.history={},this.betAmount="0.01 ETH",this.isProposing=!1,this.appInstanceId="",this.cfProvider={},this.appInstance={},this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.generateRandomRoll=function(){return[]},this.gameStatusLabel="",this.defaultHighRollerState={stage:HighRollerStage.WAITING_FOR_P1_COMMITMENT,salt:HashZero,commitHash:HashZero,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0},this.highRollerState=this.defaultHighRollerState,this.gameState=GameState.Play,this.myRoll=[1,1],this.myScore=0,this.opponentRoll=[1,1],this.opponentScore=0,this.updateUIState=function(){},this.rollingAnimationInterval={},this.rolling={myRoll:!1,opponentRoll:!1}}return e.prototype.componentWillLoad=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(e){return this.betAmount=getProp("betAmount",this),this.isProposing=getProp("isProposing",this),this.appInstanceId=getProp("appInstanceId",this),[2]})})},e.prototype.onHighRollerStateChanged=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(e){switch(e.label){case 0:return this.highRollerState.stage!==HighRollerStage.P2_COMMITTED_TO_NUM||this.rolling.opponentRoll?[3,2]:[4,this.beginRolling("opponentRoll")];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.onGameStateChanged=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(e){switch(e.label){case 0:return this.gameState===GameState.Play?[3,3]:[4,this.stopRolling("myRoll")];case 1:return e.sent(),[4,this.stopRolling("opponentRoll")];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.beginRolling=function(e){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){return this.rolling[e]=!0,this.scheduleRoll(e),[2]})})},e.prototype.scheduleRoll=function(e){var t=this;this.rollingAnimationInterval[e]=setTimeout(function(){return tslib_1.__awaiter(t,void 0,void 0,function(){return tslib_1.__generator(this,function(t){switch(t.label){case 0:return[4,this.roll(e)];case 1:return[2,t.sent()]}})})},100+Math.floor(Math.random()*Math.floor(150)))},e.prototype.roll=function(e){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){return this[e]=this.generateRandomRoll(),this.rolling[e]&&this.scheduleRoll(e),[2]})})},e.prototype.stopRolling=function(e){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){return this.rolling[e]=!1,clearTimeout(this.rollingAnimationInterval[e]),[2]})})},e.prototype.handleRoll=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var e,t,a,r,n,i,o,l,s,p,u;return tslib_1.__generator(this,function(h){switch(h.label){case 0:return this.appInstance.takeAction?[3,2]:(e=this,[4,this.cfProvider.getOrCreateAppInstance(this.appInstanceId,this.appInstance)]);case 1:e.appInstance=h.sent(),console.log("Reset appInstance",this.appInstance),h.label=2;case 2:return this.highRollerState.stage!==HighRollerStage.WAITING_FOR_P1_COMMITMENT?[3,5]:[4,this.beginRolling("myRoll")];case 3:return h.sent(),t=generateSalt(),a=1+Math.floor(Math.random()*Math.floor(1e3)),r=computeCommitHash(t,a),p={actionType:HighRollerActionType.COMMIT_TO_HASH,actionHash:r,number:0},n=this,o=(i=Object).assign,l=[{}],[4,this.appInstance.takeAction(p)];case 4:return n.highRollerState=o.apply(i,l.concat([h.sent(),{playerFirstNumber:bigNumberify(a),salt:t}])),this.updateUIState({highRollerState:this.highRollerState}),[3,8];case 5:return this.highRollerState.stage!==HighRollerStage.P1_COMMITTED_TO_HASH?[3,8]:[4,this.beginRolling("myRoll")];case 6:return h.sent(),s=1+Math.floor(Math.random()*Math.floor(1e3)),u=this,[4,this.appInstance.takeAction(p={number:s,actionType:HighRollerActionType.COMMIT_TO_NUM,actionHash:HashZero})];case 7:u.highRollerState=h.sent(),this.gameStatusLabel="Who will win?",h.label=8;case 8:return[2]}})})},e.prototype.handleRematch=function(){this.gameState=GameState.Play,this.highRollerState=this.defaultHighRollerState},e.prototype.handleExit=function(){window.location.assign("/")},e.prototype.render=function(){var e=this;return[h("div",{class:"wrapper"},h("div",{class:"game"},h("app-game-player",{playerName:this.opponent.attributes.username,playerScore:this.opponentScore,playerType:PlayerType.Black,playerRoll:this.opponentRoll}),h("app-game-status",{gameState:this.gameState,isProposing:this.isProposing,betAmount:this.betAmount,highRollerStage:this.highRollerState.stage,label:this.gameStatusLabel}),h("app-game-player",{playerName:"You",playerScore:this.myScore,playerType:PlayerType.White,playerRoll:this.myRoll}),h("div",{class:"actions"},this.gameState===GameState.Play?h("button",{class:"btn btn--center",onClick:function(){return e.handleRoll()}},"Roll your dice!"):h("button",{class:"btn btn--exit",onClick:function(){return e.handleExit()}},"Exit")))),this.gameState===GameState.Won?h("app-game-coins",null):void 0]},Object.defineProperty(e,"is",{get:function(){return"app-game"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{account:{type:"Any",attr:"account"},appInstance:{type:"Any",attr:"app-instance",mutable:!0},appInstanceId:{type:String,attr:"app-instance-id",mutable:!0},betAmount:{type:String,attr:"bet-amount",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state",mutable:!0,watchCallbacks:["onGameStateChanged"]},gameStatusLabel:{state:!0},generateRandomRoll:{type:"Any",attr:"generate-random-roll"},highRollerState:{type:"Any",attr:"high-roller-state",mutable:!0,watchCallbacks:["onHighRollerStateChanged"]},history:{type:"Any",attr:"history"},isProposing:{type:Boolean,attr:"is-proposing",mutable:!0},myRoll:{type:"Any",attr:"my-roll",mutable:!0},myScore:{type:Number,attr:"my-score",mutable:!0},opponent:{type:"Any",attr:"opponent"},opponentRoll:{type:"Any",attr:"opponent-roll",mutable:!0},opponentScore:{type:Number,attr:"opponent-score",mutable:!0},updateUIState:{type:"Any",attr:"update-u-i-state"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game:**/"},enumerable:!0,configurable:!0}),e}();CounterfactualTunnel.injectProps(AppGame,["account","opponent","cfProvider","appInstance"]),HighRollerUITunnel.injectProps(AppGame,["myRoll","myScore","opponentRoll","opponentScore","gameState","updateUIState","generateRandomRoll","highRollerState"]);var DICE_PATH="./assets/images/dice/TYPE/0",AppGameDie=function(){function e(){this.playerType=PlayerType.Black,this.value=1}return e.prototype.render=function(){var e=DICE_PATH.replace(/TYPE/gi,this.playerType);return h("div",{class:"die__wrapper"},h("div",{class:"die__faces die__face-"+this.value},h("img",{src:e+"1.svg",class:"die__1 "+this.playerType,alt:""}),h("img",{src:e+"2.svg",class:"die__2 "+this.playerType,alt:""}),h("img",{src:e+"3.svg",class:"die__3 "+this.playerType,alt:""}),h("img",{src:e+"4.svg",class:"die__4 "+this.playerType,alt:""}),h("img",{src:e+"5.svg",class:"die__5 "+this.playerType,alt:""}),h("img",{src:e+"6.svg",class:"die__6 "+this.playerType,alt:""})))},Object.defineProperty(e,"is",{get:function(){return"app-game-die"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{playerType:{type:String,attr:"player-type"},value:{type:Number,attr:"value"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-die:**/"},enumerable:!0,configurable:!0}),e}(),AppGamePlayer=function(){function e(){this.playerName="",this.playerScore=0,this.playerType=PlayerType.Black,this.playerRoll=[1,1]}return e.prototype.render=function(){return h("div",{class:"player"},h("div",{class:"player-info"},h("span",{class:"player-info__name "+this.playerType},this.playerName),h("div",{class:"player-info__status"},h("span",{class:"player-info__status__color "+this.playerType}),h("span",{class:"player-info__status__score"},this.playerScore))),h("div",{class:"player__dice"},h("app-game-die",{playerType:this.playerType,value:this.playerRoll[0]}),h("app-game-die",{playerType:this.playerType,value:this.playerRoll[1]})))},Object.defineProperty(e,"is",{get:function(){return"app-game-player"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{playerName:{type:String,attr:"player-name"},playerRoll:{type:"Any",attr:"player-roll"},playerScore:{type:Number,attr:"player-score"},playerType:{type:String,attr:"player-type"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-player:**/"},enumerable:!0,configurable:!0}),e}(),AppGameStatus=function(){function e(){this.el={},this.gameState=GameState.Play,this.highRollerStage=HighRollerStage.WAITING_FOR_P1_COMMITMENT,this.isProposing=!0,this.betAmount="0.01 ETH",this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.label=""}return Object.defineProperty(e.prototype,"gameStatusLabelForTurn",{get:function(){return this.label?this.label:this.highRollerStage===HighRollerStage.WAITING_FOR_P1_COMMITMENT||!this.isProposing&&this.highRollerStage===HighRollerStage.P1_COMMITTED_TO_HASH?"Your turn":this.opponent.attributes.username+"'s turn"},enumerable:!0,configurable:!0}),e.prototype.render=function(){return h("div",{class:"divider"},this.gameState===GameState.Play?h("div",{class:"divider__status divider__status--turn"},this.gameStatusLabelForTurn):this.gameState===GameState.Won?h("div",{class:"divider__status divider__status--won"},h("span",{class:"result"},"You Won!"),h("span",{class:"reward"},this.betAmount)):this.gameState===GameState.Lost?h("div",{class:"divider__status divider__status--lost"},h("span",{class:"result"},"You Lost!"),h("span",{class:"reward"},this.betAmount)):h("div",{class:"divider__status divider__status--turn"},"It's a tie!"))},Object.defineProperty(e,"is",{get:function(){return"app-game-status"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{account:{type:"Any",attr:"account"},betAmount:{type:String,attr:"bet-amount"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state"},highRollerStage:{type:Number,attr:"high-roller-stage"},isProposing:{type:Boolean,attr:"is-proposing"},label:{type:String,attr:"label"},opponent:{type:"Any",attr:"opponent"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"/**style-placeholder:app-game-status:**/"},enumerable:!0,configurable:!0}),e}();CounterfactualTunnel.injectProps(AppGameStatus,["account","opponent"]);export{AppGame,AppGameDie,AppGamePlayer,AppGameStatus};
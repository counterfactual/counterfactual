{"moduleFile":{"sourceFilePath":"/home/arjun/repositories/counterfactual/monorepo/packages/dapp-high-roller/src/components/app-waiting/app-waiting.tsx","localImports":["/home/arjun/repositories/counterfactual/monorepo/packages/dapp-high-roller/src/data/counterfactual","/home/arjun/repositories/counterfactual/monorepo/packages/dapp-high-roller/src/utils/utils"],"externalImports":["@stencil/core","@stencil/router"],"potentialCmpRefs":[],"cmpMeta":{"tagNameMeta":"app-waiting","stylesMeta":{"$":{"externalStyles":[{"absolutePath":"/home/arjun/repositories/counterfactual/monorepo/packages/dapp-high-roller/src/components/app-waiting/app-waiting.scss","cmpRelativePath":"app-waiting.scss","originalComponentPath":"app-waiting.scss"}]}},"assetsDirsMeta":[],"hostMeta":{},"dependencies":[],"jsdoc":{"name":"AppWaiting","tags":[],"documentation":"User Story\nBob(Proposing) waits for Alice(Accepting) to install the game","type":"typeof AppWaiting"},"encapsulationMeta":1,"componentClass":"AppWaiting","membersMeta":{"el":{"memberType":64},"seconds":{"memberType":16},"isCountdownStarted":{"memberType":16},"history":{"memberType":1,"attribName":"history","attribType":{"text":"RouterHistory","required":false,"optional":false,"typeReferences":{"RouterHistory":{"referenceLocation":"import","importReferenceLocation":"@stencil/router"}}},"reflectToAttrib":false,"propType":0,"jsdoc":{"name":"history","tags":[],"documentation":"","type":"RouterHistory","default":"{} as RouterHistory"}},"cfProvider":{"memberType":1,"attribName":"cf-provider","attribType":{"text":"any","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":1,"jsdoc":{"name":"cfProvider","tags":[],"documentation":"","type":"any"}},"opponent":{"memberType":1,"attribName":"opponent","attribType":{"text":"any","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":1,"jsdoc":{"name":"opponent","tags":[],"documentation":"","type":"any"}},"account":{"memberType":1,"attribName":"account","attribType":{"text":"any","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":1,"jsdoc":{"name":"account","tags":[],"documentation":"","type":"any"}},"appInstance":{"memberType":1,"attribName":"app-instance","attribType":{"text":"any","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":1,"jsdoc":{"name":"appInstance","tags":[],"documentation":"","type":"any"}},"myName":{"memberType":2,"attribName":"my-name","attribType":{"text":"string","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":2,"jsdoc":{"name":"myName","tags":[],"documentation":"","type":"string","default":"\"\""}},"betAmount":{"memberType":2,"attribName":"bet-amount","attribType":{"text":"string","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":2,"jsdoc":{"name":"betAmount","tags":[],"documentation":"","type":"string","default":"\"\""}},"opponentName":{"memberType":2,"attribName":"opponent-name","attribType":{"text":"string","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":2,"jsdoc":{"name":"opponentName","tags":[],"documentation":"","type":"string","default":"\"\""}},"isProposing":{"memberType":2,"attribName":"is-proposing","attribType":{"text":"boolean","required":false,"optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":4,"jsdoc":{"name":"isProposing","tags":[],"documentation":"","type":"boolean","default":"false"}}},"eventsMeta":[],"listenersMeta":[]},"hasSlot":false,"hasSvg":false,"jsFilePath":"/home/arjun/repositories/counterfactual/monorepo/packages/dapp-high-roller/src/components/app-waiting/app-waiting.js"},"jsText":"import CounterfactualTunnel from \"../../data/counterfactual\";\r\nimport { getProp } from \"../../utils/utils\";\r\nexport class AppWaiting {\r\n    constructor() {\r\n        this.el = {};\r\n        this.history = {};\r\n        this.myName = \"\";\r\n        this.betAmount = \"\";\r\n        this.opponentName = \"\";\r\n        this.isProposing = false;\r\n        this.seconds = 60;\r\n        this.isCountdownStarted = false;\r\n    }\r\n    componentWillLoad() {\r\n        this.betAmount = getProp(\"betAmount\", this);\r\n        this.isProposing = getProp(\"isProposing\", this);\r\n    }\r\n    componentDidLoad() {\r\n        this.setupWaiting();\r\n    }\r\n    countDown() {\r\n        if (this.seconds === 1) {\r\n            return;\r\n        }\r\n        setTimeout(() => {\r\n            this.seconds = this.seconds - 1;\r\n            this.countDown();\r\n        }, 1000);\r\n    }\r\n    goToGame(opponentName, appInstanceId) {\r\n        console.log(`GO TO GAME: ${opponentName}`);\r\n        this.history.push({\r\n            pathname: \"/game\",\r\n            state: {\r\n                appInstanceId,\r\n                opponentName,\r\n                betAmount: this.betAmount,\r\n                myName: this.myName,\r\n                isProposing: this.isProposing\r\n            },\r\n            query: {},\r\n            key: \"\"\r\n        });\r\n    }\r\n    startCountdown() {\r\n        if (this.isCountdownStarted) {\r\n            return;\r\n        }\r\n        this.isCountdownStarted = true;\r\n        this.countDown();\r\n    }\r\n    setupWaiting(cfProvider, appInstance, account, opponent) {\r\n        if (this.isProposing) {\r\n            this.setupWaitingProposing();\r\n        }\r\n        else {\r\n            this.setupWaitingAccepting();\r\n        }\r\n    }\r\n    setupWaitingProposing() {\r\n        if (this.isCountdownStarted) {\r\n            return;\r\n        }\r\n        this.startCountdown();\r\n    }\r\n    setupWaitingAccepting() {\r\n        this.cfProvider.once(\"updateState\", () => {\r\n            this.goToGame(this.opponentName, this.appInstance.id);\r\n        });\r\n        this.myName = this.account.user.username;\r\n        this.opponentName = this.opponent.attributes.username;\r\n    }\r\n    render() {\r\n        return (h(\"div\", { class: \"wrapper\" },\r\n            h(\"div\", { class: \"waiting\" },\r\n                h(\"div\", { class: \"message\" },\r\n                    h(\"img\", { class: \"message__icon\", src: \"/assets/images/logo.svg\", alt: \"High Roller\" }),\r\n                    h(\"h1\", { class: \"message__title\" }, \"Waiting Room\"),\r\n                    h(\"p\", { class: \"message__body\" }, this.isProposing\r\n                        ? \"Waiting for another player to join the game in\"\r\n                        : `Waiting on ${this.opponentName}'s roll...`),\r\n                    this.isProposing ? h(\"p\", { class: \"countdown\" }, this.seconds) : {},\r\n                    h(\"p\", null,\r\n                        \"Player: \",\r\n                        this.myName,\r\n                        \" \",\r\n                        h(\"br\", null),\r\n                        \"Opponent: \",\r\n                        this.opponentName,\r\n                        \" \",\r\n                        h(\"br\", null),\r\n                        \"Bet Amount: \",\r\n                        this.betAmount,\r\n                        \" ETH\")))));\r\n    }\r\n    static get is() { return \"app-waiting\"; }\r\n    static get encapsulation() { return \"shadow\"; }\r\n    static get properties() { return {\r\n        \"account\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"account\"\r\n        },\r\n        \"appInstance\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"app-instance\"\r\n        },\r\n        \"betAmount\": {\r\n            \"type\": String,\r\n            \"attr\": \"bet-amount\",\r\n            \"mutable\": true\r\n        },\r\n        \"cfProvider\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"cf-provider\"\r\n        },\r\n        \"el\": {\r\n            \"elementRef\": true\r\n        },\r\n        \"history\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"history\"\r\n        },\r\n        \"isCountdownStarted\": {\r\n            \"state\": true\r\n        },\r\n        \"isProposing\": {\r\n            \"type\": Boolean,\r\n            \"attr\": \"is-proposing\",\r\n            \"mutable\": true\r\n        },\r\n        \"myName\": {\r\n            \"type\": String,\r\n            \"attr\": \"my-name\",\r\n            \"mutable\": true\r\n        },\r\n        \"opponent\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"opponent\"\r\n        },\r\n        \"opponentName\": {\r\n            \"type\": String,\r\n            \"attr\": \"opponent-name\",\r\n            \"mutable\": true\r\n        },\r\n        \"seconds\": {\r\n            \"state\": true\r\n        }\r\n    }; }\r\n    static get style() { return \"/**style-placeholder:app-waiting:**/\"; }\r\n}\r\nCounterfactualTunnel.injectProps(AppWaiting, [\r\n    \"cfProvider\",\r\n    \"appInstance\",\r\n    \"account\",\r\n    \"opponent\"\r\n]);\r\n"}
const t=window.App.h;import"./chunk-deed3e85.js";import{a as e,b as o,c as s,e as n}from"./chunk-a0cc8100.js";import{a as i}from"./chunk-91bb08fc.js";import{a,b as r,c,d as l,e as p,f as h,g as d,h as u,i as y,j as m,k as g,l as f,m as b,n as S,o as w,p as A,q as T,r as P,s as v,t as I,u as R}from"./chunk-4f14aa24.js";var E;!function(t){let e,o,s;!function(t){t.ERROR="error"}(e=t.ErrorType||(t.ErrorType={})),function(t){t.GET_APP_INSTANCES="getAppInstances",t.GET_PROPOSED_APP_INSTANCES="getProposedAppInstances",t.PROPOSE_INSTALL="proposeInstall",t.PROPOSE_INSTALL_VIRTUAL="proposeInstallVirtual",t.REJECT_INSTALL="rejectInstall",t.INSTALL="install",t.INSTALL_VIRTUAL="installVirtual",t.GET_STATE="getState",t.GET_APP_INSTANCE_DETAILS="getAppInstanceDetails",t.TAKE_ACTION="takeAction",t.UNINSTALL="uninstall",t.UNINSTALL_VIRTUAL="uninstallVirtual",t.PROPOSE_STATE="proposeState",t.ACCEPT_STATE="acceptState",t.REJECT_STATE="rejectState",t.CREATE_MULTISIG="createMultisig",t.GET_CHANNEL_ADDRESSES="getChannelAddresses",t.MATCHMAKE="matchmake"}(o=t.MethodName||(t.MethodName={})),function(t){t.INSTALL="installEvent",t.REJECT_INSTALL="rejectInstallEvent",t.UPDATE_STATE="updateStateEvent",t.UNINSTALL="uninstallEvent",t.PROPOSE_STATE="proposeStateEvent",t.REJECT_STATE="rejectStateEvent",t.CREATE_MULTISIG="createMultisigEvent",t.MATCH_MADE="matchmade"}(s=t.EventName||(t.EventName={}))}(E||(E={}));class N{constructor(){this.isConnected=!1,this.callback=(()=>{})}onMessage(t){this.callback=t}sendMessage(t){if(!this.isConnected)throw new Error("It's not possible to use postMessage() before the NodeProvider is connected. Call the connect() method first.");const e=`app-instance-${(new Date).valueOf()}`;switch(t.type){case E.MethodName.PROPOSE_INSTALL_VIRTUAL:this.sendCallback({type:E.MethodName.PROPOSE_INSTALL_VIRTUAL,result:{appInstanceId:e},requestId:t.requestId},100),this.sendCallback({type:E.EventName.INSTALL,data:{appInstanceId:e}},5e3);break;case E.MethodName.GET_APP_INSTANCE_DETAILS:this.sendCallback({type:E.MethodName.GET_APP_INSTANCE_DETAILS,result:{appInstance:{id:t.params.appInstanceId}},requestId:t.requestId},1);break;default:console.error("Unhandled message in MockNodeProvider:",t)}}sendCallback(t,e){setTimeout(()=>{this.callback(t)},e)}async connect(){return this.isConnected?(console.warn("NodeProvider is already connected."),Promise.resolve(this)):new Promise((t,e)=>setTimeout(()=>(this.isConnected=!0,t(this)),1e3))}}const O=ethers.utils.bigNumberify;class L{constructor(){this.el={},this.history={},this.updateAppInstance=(()=>{}),this.updateAppFactory=(()=>{}),this.updateCfProvider=(()=>{}),this.updateIntermediary=(()=>{}),this.updateUIState=(()=>{}),this.goToGame=(()=>{}),this.highRoller=(async()=>({playerFirstRoll:[0,0],playerSecondRoll:[0,0]})),this.generateRandomRoll=(()=>[0,0]),this.highRollerState={},this.gameState=e.Play,this.myRoll=[1,1],this.myScore=0,this.opponentRoll=[1,1],this.opponentScore=0,this.nodeProvider={},this.cfProvider={},this.appFactory={},this.appInstance={},this.intermediary=""}async componentWillLoad(){const t=new URLSearchParams(window.location.search);this.nodeProvider=t.get("standalone")?new N:new cf.NodeProvider,await this.nodeProvider.connect(),this.setupCfProvider()}setupCfProvider(){this.cfProvider=new cf.Provider(this.nodeProvider),this.cfProvider.on("chan_updateState",this.onUpdateState.bind(this)),this.cfProvider.on("chan_uninstall",this.onUninstall.bind(this)),this.cfProvider.on("chan_installVirtual",this.onInstall.bind(this)),this.appFactory=new cf.AppFactory("0x144F1A5C2db59B58f2c73d09A2acb27a57E47618",{actionEncoding:"tuple(uint8 actionType, uint256 number, bytes32 actionHash)",stateEncoding:"\n          tuple(\n            uint8 stage,\n            bytes32 salt,\n            bytes32 commitHash,\n            uint256 playerFirstNumber,\n            uint256 playerSecondNumber,\n            uint256 versionNumber\n          )\n        "},this.cfProvider),this.updateAppFactory(this.appFactory),this.updateCfProvider(this.cfProvider)}isReadyForHighRoller(t){return O(t.playerFirstNumber).toNumber()&&O(t.playerSecondNumber).toNumber()&&t.stage===o.P1_REVEALED_NUM}async onUpdateState({data:t}){const n=t.newState,i=Object.assign({},n,{playerFirstNumber:this.highRollerState.playerFirstNumber||n.playerFirstNumber});if(console.log("playerFirstNumber",i.playerFirstNumber,"playerSecondNumber",i.playerSecondNumber),i.stage===o.P2_COMMITTED_TO_NUM)return await this.appInstance.takeAction({actionType:s.REVEAL_NUM,actionHash:this.highRollerState.salt,number:i.playerFirstNumber});if(!this.isReadyForHighRoller(i))return void this.updateUIState({highRollerState:i});let a,r=this.myScore,c=this.opponentScore;const l=await this.highRoller(i.playerFirstNumber,i.playerSecondNumber),p=l.playerSecondRoll,h=l.playerFirstRoll,d=p[0]+p[1],u=h[0]+h[1];d>u?(r=this.myScore+1,a=e.Won):d<u?(c+=1,a=e.Lost):a=e.Tie,this.updateUIState({myRoll:p,opponentRoll:h,myScore:r,opponentScore:c,gameState:a,highRollerState:i}),i.stage===o.P1_REVEALED_NUM&&await this.appInstance.uninstall(this.intermediary)}onInstall(t){this.updateAppInstance(t.data.appInstance),this.goToGame(this.history)}onUninstall(t){}render(){return t("slot",null)}static get is(){return"app-provider"}static get properties(){return{appFactory:{type:"Any",attr:"app-factory",mutable:!0},appInstance:{type:"Any",attr:"app-instance",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider",mutable:!0},el:{elementRef:!0},gameState:{type:Number,attr:"game-state"},generateRandomRoll:{type:"Any",attr:"generate-random-roll"},goToGame:{type:"Any",attr:"go-to-game"},highRoller:{type:"Any",attr:"high-roller"},highRollerState:{type:"Any",attr:"high-roller-state"},history:{type:"Any",attr:"history"},intermediary:{type:String,attr:"intermediary"},myRoll:{type:"Any",attr:"my-roll"},myScore:{type:Number,attr:"my-score"},nodeProvider:{type:"Any",attr:"node-provider",mutable:!0},opponentRoll:{type:"Any",attr:"opponent-roll"},opponentScore:{type:Number,attr:"opponent-score"},updateAppFactory:{type:"Any",attr:"update-app-factory"},updateAppInstance:{type:"Any",attr:"update-app-instance"},updateCfProvider:{type:"Any",attr:"update-cf-provider"},updateIntermediary:{type:"Any",attr:"update-intermediary"},updateUIState:{type:"Any",attr:"update-u-i-state"}}}}i.injectProps(L,["myRoll","myScore","opponentRoll","opponentScore","gameState","updateUIState","highRollerState"]),n.injectProps(L,["appInstance","intermediary"]);const{solidityKeccak256:U}=ethers.utils,{HashZero:C}=ethers.constants;class M{constructor(){this.userDataReceived=!1,this.history={};const t=new URLSearchParams(window.location.search);this.state={account:{},opponent:{},standalone:"true"===t.get("standalone")||!1,appInstance:null,appFactory:null,cfProvider:null,intermediary:null,updateAppInstance:this.updateAppInstance.bind(this),updateAppFactory:this.updateAppFactory.bind(this),updateUser:this.updateAccount.bind(this),updateOpponent:this.updateOpponent.bind(this),updateCfProvider:this.updateCfProvider.bind(this),updateIntermediary:this.updateIntermediary.bind(this)},this.uiState={myRoll:[0,0],myScore:0,opponentRoll:[0,0],opponentScore:0,gameState:e.Play,updateUIState:this.updateUIState.bind(this),highRoller:this.highRoller.bind(this),generateRandomRoll:this.generateRandomRoll.bind(this),highRollerState:{stage:o.WAITING_FOR_P1_COMMITMENT,salt:C,commitHash:C,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0}},window.addEventListener("popstate",()=>{window.parent.postMessage(`playground:send:dappRoute|${location.hash}`,"*")})}setupPlaygroundMessageListeners(){window.addEventListener("message",async t=>{if("string"==typeof t.data&&t.data.startsWith("playground:response:user")){const[,e]=t.data.split("|"),o=JSON.parse(e);this.updateAccount(o),this.userDataReceived=!0}if("string"==typeof t.data&&t.data.startsWith("playground:response:appInstance")){const[,e]=t.data.split("|");if(e){console.log("Received playground appInstance: ",e);const{appInstance:t}=JSON.parse(e);this.updateAppInstance(t),this.updateOpponent({attributes:{nodeAddress:this.state.appInstance.initialState.initiatorAddress}}),this.goToWaitingRoom(this.history)}}})}async componentWillLoad(){this.setupPlaygroundMessageListeners()}async componentDidLoad(){window.parent.postMessage("playground:request:user","*"),this.state.standalone&&(this.updateAccount({user:{address:"0xc60b9023bb8dc153b4046977328ce79af12a77e0",email:"alon2@example.com",id:"687297bc-8014-4c82-8cee-3b7ca7db09d4",username:"MyName"},multisigAddress:"0x9499ac5A66c36447e535d252c049304D80961CED"}),this.userDataReceived=!0)}receiveRouterHistory(t){this.history=t}updateAccount(t){this.state=Object.assign({},this.state,{account:t}),ga("set","userId",t.user.id)}updateOpponent(t){this.state=Object.assign({},this.state,{opponent:t})}updateAppInstance(t){this.state=Object.assign({},this.state,{appInstance:t}),console.log("appInstance updated",t)}updateAppFactory(t){this.state=Object.assign({},this.state,{appFactory:t})}updateCfProvider(t){this.state=Object.assign({},this.state,{cfProvider:t}),console.log("CFProvider instance updated")}updateIntermediary(t){this.state=Object.assign({},this.state,{intermediary:t})}updateUIState(t){this.uiState=Object.assign({},this.uiState,t),console.log("%cNew UI state detected","font-size: 14px; color: red"),console.log("    ",this.uiState)}generateRandomRoll(){return[1+Math.floor(Math.random()*Math.floor(6)),1+Math.floor(Math.random()*Math.floor(6))]}async highRoller(t,e){const o=U(["uint256"],[t.mul(e)]),s=new ethers.providers.Web3Provider(web3.currentProvider),n=new ethers.Contract("0x144F1A5C2db59B58f2c73d09A2acb27a57E47618",["\n      function highRoller(bytes32 randomness)\n        public\n        pure\n        returns(uint8 playerFirstTotal, uint8 playerSecondTotal)\n    "],s),i=await n.highRoller(o);return{playerFirstRoll:this.getDieNumbers(i[0]),playerSecondRoll:this.getDieNumbers(i[1])}}getDieNumbers(t){return 12===t?[6,6]:t>2&&t<12?[Math.floor(t/2),Math.ceil(t/2)]:t>2&&t%2==0?[Math.floor(t/2)-1,Math.ceil(t/2)+1]:[t/2,t/2]}goToGame(t,e=!0){t.push({pathname:"/game",state:{isProposing:e,betAmount:ethers.utils.formatEther(this.state.appInstance.initiatorDeposit)},query:{},key:""})}goToWaitingRoom(t){t.push("/waiting",{isProposing:!1,betAmount:ethers.utils.formatEther(this.state.appInstance.responderDeposit)})}render(){return this.userDataReceived?t("div",{class:"height-100"},t("main",{class:"height-100"},t(n.Provider,{state:this.state},t(i.Provider,{state:this.uiState},t("stencil-router",{historyType:"hash"},t("stencil-route-switch",{scrollTopOffset:0},t("app-provider",{updateAppInstance:this.state.updateAppInstance.bind(this),updateAppFactory:this.state.updateAppFactory.bind(this),updateCfProvider:this.state.updateCfProvider.bind(this),updateIntermediary:this.state.updateIntermediary.bind(this),updateUIState:this.uiState.updateUIState.bind(this),highRoller:this.uiState.highRoller.bind(this),generateRandomRoll:this.uiState.generateRandomRoll.bind(this),goToGame:this.goToGame.bind(this),history:this.history},t("stencil-route",{url:"/",exact:!0,component:"app-logo",componentProps:{cfProvider:this.state.cfProvider,appInstance:this.state.appInstance,goToWaitingRoom:this.goToWaitingRoom,updateAppInstance:this.updateAppInstance,provideRouterHistory:this.receiveRouterHistory.bind(this)}}),t("stencil-route",{url:"/wager",component:"app-wager",componentProps:{updateOpponent:this.state.updateOpponent}}),t("stencil-route",{url:"/game",component:"app-game"}),t("stencil-route",{url:"/waiting",component:"app-waiting",componentProps:{cfProvider:this.state.cfProvider,appInstance:this.state.appInstance,goToWaitingRoom:this.goToWaitingRoom,updateAppInstance:this.updateAppInstance,history:this.history}}),t("stencil-route",{url:"/accept-invite",component:"app-accept-invite"})))))))):t("h1",{class:"App message"},"connecting....")}static get is(){return"app-root"}static get encapsulation(){return"shadow"}static get properties(){return{history:{state:!0},state:{type:"Any",attr:"state",mutable:!0},uiState:{type:"Any",attr:"ui-state",mutable:!0},userDataReceived:{state:!0}}}static get style(){return"/**style-placeholder:app-root:**/"}}var _=function(t,e,o,s){return new(o||(o=Promise))(function(n,i){function a(t){try{c(s.next(t))}catch(t){i(t)}}function r(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(a,r)}c((s=s.apply(t,e||[])).next())})};class k{constructor(){this.group=null,this.match=null,this.componentProps={},this.exact=!1,this.scrollOnNextRender=!1,this.previousMatch=null}computeMatch(t){const e=null!=this.group||null!=this.el.parentElement&&"stencil-route-switch"===this.el.parentElement.tagName.toLowerCase();if(t&&!e)return this.previousMatch=this.match,this.match=a(t.pathname,{path:this.url,exact:this.exact,strict:!0})}loadCompleted(){return _(this,void 0,void 0,function*(){let t={};this.history&&this.history.location.hash?t={scrollToId:this.history.location.hash.substr(1)}:this.scrollTopOffset&&(t={scrollTopOffset:this.scrollTopOffset}),"function"==typeof this.componentUpdated?this.componentUpdated(t):this.match&&!r(this.match,this.previousMatch)&&this.routeViewsUpdated&&this.routeViewsUpdated(t)})}componentDidUpdate(){return _(this,void 0,void 0,function*(){yield this.loadCompleted()})}componentDidLoad(){return _(this,void 0,void 0,function*(){yield this.loadCompleted()})}render(){if(!this.match||!this.history)return null;const e=Object.assign({},this.componentProps,{history:this.history,match:this.match});return this.routeRender?this.routeRender(Object.assign({},e,{component:this.component})):this.component?t(this.component,Object.assign({},e)):void 0}static get is(){return"stencil-route"}static get properties(){return{component:{type:String,attr:"component"},componentProps:{type:"Any",attr:"component-props"},componentUpdated:{type:"Any",attr:"component-updated"},el:{elementRef:!0},exact:{type:Boolean,attr:"exact"},group:{type:String,attr:"group",reflectToAttr:!0},history:{type:"Any",attr:"history"},historyType:{type:String,attr:"history-type"},location:{type:"Any",attr:"location",watchCallbacks:["computeMatch"]},match:{type:"Any",attr:"match",mutable:!0},routeRender:{type:"Any",attr:"route-render"},routeViewsUpdated:{type:"Any",attr:"route-views-updated"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"},url:{type:String,attr:"url"}}}static get style(){return"/**style-placeholder:stencil-route:**/"}}c.injectProps(k,["location","history","historyType","routeViewsUpdated"]);var x=function(t,e,o,s){return new(o||(o=Promise))(function(n,i){function a(t){try{c(s.next(t))}catch(t){i(t)}}function r(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(a,r)}c((s=s.apply(t,e||[])).next())})};function F(t){return"stencil-route"===t.tagName.toLowerCase()}class j{constructor(){this.group=window.crypto?([1e7].toString()+-1e3.toString()+-4e3.toString()+-8e3.toString()+-1e11.toString()).replace(/[018]/g,function(t){return(t^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):((1e17*Math.random()).toString().match(/.{4}/g)||[]).join("-"),this.subscribers=[]}componentWillLoad(){null!=this.location&&this.regenerateSubscribers(this.location)}regenerateSubscribers(t){return x(this,void 0,void 0,function*(){if(null==t)return;let e=-1;if(this.subscribers=Array.prototype.slice.call(this.el.children).filter(F).map((o,s)=>{const n=function(e,s,n){return a(t.pathname,{path:o.url,exact:o.exact,strict:!0})}();return n&&-1===e&&(e=s),{el:o,match:n}}),-1===e)return;if(this.activeIndex===e)return void(this.subscribers[e].el.match=this.subscribers[e].match);this.activeIndex=e;const o=this.subscribers[this.activeIndex];this.scrollTopOffset&&(o.el.scrollTopOffset=this.scrollTopOffset),o.el.group=this.group,o.el.match=o.match,o.el.componentUpdated=(t=>{this.queue.write(()=>{this.subscribers.forEach((t,e)=>{if(t.el.componentUpdated=void 0,e===this.activeIndex)return t.el.style.display="";this.scrollTopOffset&&(t.el.scrollTopOffset=this.scrollTopOffset),t.el.group=this.group,t.el.match=null,t.el.style.display="none"})}),this.routeViewsUpdated&&this.routeViewsUpdated(Object.assign({scrollTopOffset:this.scrollTopOffset},t))})})}render(){return t("slot",null)}static get is(){return"stencil-route-switch"}static get properties(){return{el:{elementRef:!0},group:{type:String,attr:"group",reflectToAttr:!0},location:{type:"Any",attr:"location",watchCallbacks:["regenerateSubscribers"]},queue:{context:"queue"},routeViewsUpdated:{type:"Any",attr:"route-views-updated"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"}}}}function D(t,...e){t||console.error(...e)}function H(t,...e){t||console.warn(...e)}c.injectProps(j,["location","routeViewsUpdated"]);const V=()=>{let t,e=[];return{setPrompt:e=>(H(null==t,"A history supports only one prompt at a time"),t=e,()=>{t===e&&(t=null)}),confirmTransitionTo:(e,o,s,n)=>{if(null!=t){const i="function"==typeof t?t(e,o):t;"string"==typeof i?"function"==typeof s?s(i,n):(H(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),n(!0)):n(!1!==i)}else n(!0)},appendListener:t=>{let o=!0;const s=(...e)=>{o&&t(...e)};return e.push(s),()=>{o=!1,e=e.filter(t=>t!==s)}},notifyListeners:(...t)=>{e.forEach(e=>e(...t))}}},G=(t="scrollPositions")=>{let e=new Map;if(l("sessionStorage")){const o=window.sessionStorage.getItem(t);e=o?new Map(JSON.parse(o)):e}function o(t,o){if(e.set(t,o),l("sessionStorage")){const t=[];e.forEach((e,o)=>{t.push([o,e])}),window.sessionStorage.setItem("scrollPositions",JSON.stringify(t))}}return"scrollRestoration"in history&&(history.scrollRestoration="manual"),{set:o,get:function(t){return e.get(t)},has:function(t){return e.has(t)},capture:function(t){o(t,[window.scrollX,window.scrollY])}}},W=()=>{try{return window.history.state||{}}catch(t){return{}}},q={hashbang:{encodePath:t=>"!"===t.charAt(0)?t:"!/"+I(t),decodePath:t=>"!"===t.charAt(0)?t.substr(1):t},noslash:{encodePath:I,decodePath:m},slash:{encodePath:m,decodePath:m}},B=()=>{const t=window.location.href,e=t.indexOf("#");return-1===e?"":t.substring(e+1)},J=t=>{const e=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,e>=0?e:0)+"#"+t)};var Y=function(t,e,o,s){return new(o||(o=Promise))(function(n,i){function a(t){try{c(s.next(t))}catch(t){i(t)}}function r(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(a,r)}c((s=s.apply(t,e||[])).next())})};function K(t,e){const o=0==t.pathname.indexOf(e)?"/"+t.pathname.slice(e.length):t.pathname;return Object.assign({},t,{pathname:o})}const $={browser:(t={})=>{D(p,"Browser history needs a DOM");const e=window.history,o=h(),s=!d(),n=G(),i=null!=t.forceRefresh&&t.forceRefresh,a=null!=t.getUserConfirmation?t.getUserConfirmation:u,r=null!=t.keyLength?t.keyLength:6,c=t.basename?y(m(t.basename)):"",l=t=>{t=t||{};const{key:e,state:o}=t,{pathname:s,search:n,hash:i}=window.location;let a=s+n+i;return H(!c||g(a,c),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+a+'" to begin with "'+c+'".'),c&&(a=f(a,c)),b(a,o,e||S(r))},v=V(),I=t=>{n.capture(j.location.key),Object.assign(j,t),j.location.scrollPosition=n.get(j.location.key),j.length=e.length,v.notifyListeners(j.location,j.action)},R=t=>{P(t)||O(l(t.state))},E=()=>{O(l(W()))};let N=!1;const O=t=>{if(N)N=!1,I();else{const e="POP";v.confirmTransitionTo(t,e,a,o=>{o?I({action:e,location:t}):L(t)})}},L=t=>{let e=C.indexOf(j.location.key);-1===e&&(e=0);let o=C.indexOf(t.key);-1===o&&(o=0);const s=e-o;s&&(N=!0,_(s))},U=l(W());let C=[U.key];const M=t=>c+w(t),_=t=>{e.go(t)};let k=0;const x=t=>{1===(k+=t)?(A(window,"popstate",R),s&&A(window,"hashchange",E)):0===k&&(T(window,"popstate",R),s&&T(window,"hashchange",E))};let F=!1;const j={length:e.length,action:"POP",location:U,createHref:M,push:(t,s)=>{H(!("object"==typeof t&&void 0!==t.state&&void 0!==s),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");const n=b(t,s,S(r),j.location);v.confirmTransitionTo(n,"PUSH",a,t=>{if(!t)return;const s=M(n),{key:a,state:r}=n;if(o)if(e.pushState({key:a,state:r},void 0,s),i)window.location.href=s;else{const t=C.indexOf(j.location.key),e=C.slice(0,-1===t?0:t+1);e.push(n.key),C=e,I({action:"PUSH",location:n})}else H(void 0===r,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=s})},replace:(t,s)=>{H(!("object"==typeof t&&void 0!==t.state&&void 0!==s),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");const n=b(t,s,S(r),j.location);v.confirmTransitionTo(n,"REPLACE",a,t=>{if(!t)return;const s=M(n),{key:a,state:r}=n;if(o)if(e.replaceState({key:a,state:r},void 0,s),i)window.location.replace(s);else{const t=C.indexOf(j.location.key);-1!==t&&(C[t]=n.key),I({action:"REPLACE",location:n})}else H(void 0===r,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(s)})},go:_,goBack:()=>_(-1),goForward:()=>_(1),block:(t="")=>{const e=v.setPrompt(t);return F||(x(1),F=!0),()=>(F&&(F=!1,x(-1)),e())},listen:t=>{const e=v.appendListener(t);return x(1),()=>{x(-1),e()}}};return j},hash:(t={})=>{D(p,"Hash history needs a DOM");const e=window.history,o=v(),s=null!=t.keyLength?t.keyLength:6,{getUserConfirmation:n=u,hashType:i="slash"}=t,a=t.basename?y(m(t.basename)):"",{encodePath:r,decodePath:c}=q[i],l=()=>{let t=c(B());return H(!a||g(t,a),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+t+'" to begin with "'+a+'".'),a&&(t=f(t,a)),b(t,void 0,S(s))},h=V(),d=t=>{Object.assign(j,t),j.length=e.length,h.notifyListeners(j.location,j.action)};let P=!1,I=null;const E=()=>{const t=B(),e=r(t);if(t!==e)J(e);else{const t=l(),e=j.location;if(!P&&R(e,t))return;if(I===w(t))return;I=null,N(t)}},N=t=>{if(P)P=!1,d();else{const e="POP";h.confirmTransitionTo(t,e,n,o=>{o?d({action:e,location:t}):O(t)})}},O=t=>{let e=M.lastIndexOf(w(j.location));-1===e&&(e=0);let o=M.lastIndexOf(w(t));-1===o&&(o=0);const s=e-o;s&&(P=!0,_(s))},L=B(),U=r(L);L!==U&&J(U);const C=l();let M=[w(C)];const _=t=>{H(o,"Hash history go(n) causes a full page reload in this browser"),e.go(t)};let k=0;const x=t=>{1===(k+=t)?A(window,"hashchange",E):0===k&&T(window,"hashchange",E)};let F=!1;const j={length:e.length,action:"POP",location:C,createHref:t=>"#"+r(a+w(t)),push:(t,e)=>{H(void 0===e,"Hash history cannot push state; it is ignored");const o=b(t,void 0,S(s),j.location);h.confirmTransitionTo(o,"PUSH",n,t=>{if(!t)return;const e=w(o),s=r(a+e);if(B()!==s){I=e,(t=>window.location.hash=t)(s);const t=M.lastIndexOf(w(j.location)),n=M.slice(0,-1===t?0:t+1);n.push(e),M=n,d({action:"PUSH",location:o})}else H(!1,"Hash history cannot PUSH the same path; a new entry will not be added to the history stack"),d()})},replace:(t,e)=>{H(void 0===e,"Hash history cannot replace state; it is ignored");const o=b(t,void 0,S(s),j.location);h.confirmTransitionTo(o,"REPLACE",n,t=>{if(!t)return;const e=w(o),s=r(a+e);B()!==s&&(I=e,J(s));const n=M.indexOf(w(j.location));-1!==n&&(M[n]=e),d({action:"REPLACE",location:o})})},go:_,goBack:()=>_(-1),goForward:()=>_(1),block:(t="")=>{const e=h.setPrompt(t);return F||(x(1),F=!0),()=>(F&&(F=!1,x(-1)),e())},listen:t=>{const e=h.appendListener(t);return x(1),()=>{x(-1),e()}}};return j}};class z{constructor(){this.root="/",this.historyType="browser",this.titleSuffix="",this.routeViewsUpdated=((t={})=>{if(t.scrollToId&&"browser"===this.historyType){const e=document.getElementById(t.scrollToId);if(e)return e.scrollIntoView()}this.scrollTo(t.scrollTopOffset||this.scrollTopOffset)})}componentWillLoad(){this.history=$[this.historyType](),this.history.listen(t=>Y(this,void 0,void 0,function*(){t=K(t,this.root),this.location=t})),this.location=K(this.history.location,this.root)}scrollTo(t){if(null!=t&&!this.isServer&&this.history)return"POP"===this.history.action&&Array.isArray(this.history.location.scrollPosition)?this.queue.write(()=>{this.history&&this.history.location&&Array.isArray(this.history.location.scrollPosition)&&window.scrollTo(this.history.location.scrollPosition[0],this.history.location.scrollPosition[1])}):this.queue.write(()=>{window.scrollTo(0,t)})}render(){if(this.location&&this.history)return t(c.Provider,{state:{historyType:this.historyType,location:this.location,titleSuffix:this.titleSuffix,root:this.root,history:this.history,routeViewsUpdated:this.routeViewsUpdated}},t("slot",null))}static get is(){return"stencil-router"}static get properties(){return{history:{state:!0},historyType:{type:String,attr:"history-type"},isServer:{context:"isServer"},location:{state:!0},queue:{context:"queue"},root:{type:String,attr:"root"},scrollTopOffset:{type:Number,attr:"scroll-top-offset"},titleSuffix:{type:String,attr:"title-suffix"}}}}export{L as AppProvider,M as AppRoot,k as StencilRoute,j as StencilRouteSwitch,z as StencilRouter};
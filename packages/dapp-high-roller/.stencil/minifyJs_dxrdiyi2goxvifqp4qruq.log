const t=window.App.h;import{a as e,b as a,c as s}from"./chunk-960e9c51.js";import"./chunk-deed3e85.js";import{b as l,a as i,c as r,d as o,e as n}from"./chunk-a0cc8100.js";import{a as p}from"./chunk-91bb08fc.js";const{HashZero:h}=ethers.constants,{bigNumberify:c}=ethers.utils;class y{constructor(){this.el={},this.history={},this.betAmount="0.01 ETH",this.isProposing=!1,this.appInstanceId="",this.cfProvider={},this.appInstance={},this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.generateRandomRoll=(()=>[]),this.gameStatusLabel="",this.defaultHighRollerState={stage:l.WAITING_FOR_P1_COMMITMENT,salt:h,commitHash:h,playerFirstNumber:0,playerSecondNumber:0,versionNumber:0},this.highRollerState=this.defaultHighRollerState,this.gameState=i.Play,this.myRoll=[1,1],this.myScore=0,this.opponentRoll=[1,1],this.opponentScore=0,this.updateUIState=(()=>{}),this.rollingAnimationInterval={},this.rolling={myRoll:!1,opponentRoll:!1}}async componentWillLoad(){this.betAmount=e("betAmount",this),this.isProposing=e("isProposing",this),this.appInstanceId=e("appInstanceId",this)}async onHighRollerStateChanged(){this.highRollerState.stage!==l.P2_COMMITTED_TO_NUM||this.rolling.opponentRoll||await this.beginRolling("opponentRoll")}async onGameStateChanged(){this.gameState!==i.Play&&(await this.stopRolling("myRoll"),await this.stopRolling("opponentRoll"))}async beginRolling(t){this.rolling[t]=!0,this.scheduleRoll(t)}scheduleRoll(t){this.rollingAnimationInterval[t]=setTimeout(async()=>await this.roll(t),100+Math.floor(Math.random()*Math.floor(150)))}async roll(t){this[t]=this.generateRandomRoll(),this.rolling[t]&&this.scheduleRoll(t)}async stopRolling(t){this.rolling[t]=!1,clearTimeout(this.rollingAnimationInterval[t])}async handleRoll(){if(this.appInstance.takeAction||(this.appInstance=await this.cfProvider.getOrCreateAppInstance(this.appInstanceId,this.appInstance),console.log("Reset appInstance",this.appInstance)),this.highRollerState.stage===l.WAITING_FOR_P1_COMMITMENT){await this.beginRolling("myRoll");const t=a(),e=1+Math.floor(Math.random()*Math.floor(1e3)),l=s(t,e),i={actionType:r.COMMIT_TO_HASH,actionHash:l,number:0};this.highRollerState=Object.assign({},await this.appInstance.takeAction(i),{playerFirstNumber:c(e),salt:t}),this.updateUIState({highRollerState:this.highRollerState})}else if(this.highRollerState.stage===l.P1_COMMITTED_TO_HASH){await this.beginRolling("myRoll");const t={number:1+Math.floor(Math.random()*Math.floor(1e3)),actionType:r.COMMIT_TO_NUM,actionHash:h};this.highRollerState=await this.appInstance.takeAction(t),this.gameStatusLabel="Who will win?"}}handleRematch(){this.gameState=i.Play,this.highRollerState=this.defaultHighRollerState}handleExit(){window.location.assign("/")}render(){return[t("div",{class:"wrapper"},t("div",{class:"game"},t("app-game-player",{playerName:this.opponent.attributes.username,playerScore:this.opponentScore,playerType:o.Black,playerRoll:this.opponentRoll}),t("app-game-status",{gameState:this.gameState,isProposing:this.isProposing,betAmount:this.betAmount,highRollerStage:this.highRollerState.stage,label:this.gameStatusLabel}),t("app-game-player",{playerName:"You",playerScore:this.myScore,playerType:o.White,playerRoll:this.myRoll}),t("div",{class:"actions"},this.gameState===i.Play?t("button",{class:"btn btn--center",onClick:()=>this.handleRoll()},"Roll your dice!"):t("button",{class:"btn btn--exit",onClick:()=>this.handleExit()},"Exit")))),this.gameState===i.Won?t("app-game-coins",null):void 0]}static get is(){return"app-game"}static get encapsulation(){return"shadow"}static get properties(){return{account:{type:"Any",attr:"account"},appInstance:{type:"Any",attr:"app-instance",mutable:!0},appInstanceId:{type:String,attr:"app-instance-id",mutable:!0},betAmount:{type:String,attr:"bet-amount",mutable:!0},cfProvider:{type:"Any",attr:"cf-provider"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state",mutable:!0,watchCallbacks:["onGameStateChanged"]},gameStatusLabel:{state:!0},generateRandomRoll:{type:"Any",attr:"generate-random-roll"},highRollerState:{type:"Any",attr:"high-roller-state",mutable:!0,watchCallbacks:["onHighRollerStateChanged"]},history:{type:"Any",attr:"history"},isProposing:{type:Boolean,attr:"is-proposing",mutable:!0},myRoll:{type:"Any",attr:"my-roll",mutable:!0},myScore:{type:Number,attr:"my-score",mutable:!0},opponent:{type:"Any",attr:"opponent"},opponentRoll:{type:"Any",attr:"opponent-roll",mutable:!0},opponentScore:{type:Number,attr:"opponent-score",mutable:!0},updateUIState:{type:"Any",attr:"update-u-i-state"}}}static get style(){return"/**style-placeholder:app-game:**/"}}n.injectProps(y,["account","opponent","cfProvider","appInstance"]),p.injectProps(y,["myRoll","myScore","opponentRoll","opponentScore","gameState","updateUIState","generateRandomRoll","highRollerState"]);const g="./assets/images/dice/TYPE/0";class u{constructor(){this.playerType=o.Black,this.value=1}render(){const e=g.replace(/TYPE/gi,this.playerType);return t("div",{class:"die__wrapper"},t("div",{class:`die__faces die__face-${this.value}`},t("img",{src:`${e}1.svg`,class:`die__1 ${this.playerType}`,alt:""}),t("img",{src:`${e}2.svg`,class:`die__2 ${this.playerType}`,alt:""}),t("img",{src:`${e}3.svg`,class:`die__3 ${this.playerType}`,alt:""}),t("img",{src:`${e}4.svg`,class:`die__4 ${this.playerType}`,alt:""}),t("img",{src:`${e}5.svg`,class:`die__5 ${this.playerType}`,alt:""}),t("img",{src:`${e}6.svg`,class:`die__6 ${this.playerType}`,alt:""})))}static get is(){return"app-game-die"}static get encapsulation(){return"shadow"}static get properties(){return{playerType:{type:String,attr:"player-type"},value:{type:Number,attr:"value"}}}static get style(){return"/**style-placeholder:app-game-die:**/"}}class m{constructor(){this.playerName="",this.playerScore=0,this.playerType=o.Black,this.playerRoll=[1,1]}render(){return t("div",{class:"player"},t("div",{class:"player-info"},t("span",{class:`player-info__name ${this.playerType}`},this.playerName),t("div",{class:"player-info__status"},t("span",{class:`player-info__status__color ${this.playerType}`}),t("span",{class:"player-info__status__score"},this.playerScore))),t("div",{class:"player__dice"},t("app-game-die",{playerType:this.playerType,value:this.playerRoll[0]}),t("app-game-die",{playerType:this.playerType,value:this.playerRoll[1]})))}static get is(){return"app-game-player"}static get encapsulation(){return"shadow"}static get properties(){return{playerName:{type:String,attr:"player-name"},playerRoll:{type:"Any",attr:"player-roll"},playerScore:{type:Number,attr:"player-score"},playerType:{type:String,attr:"player-type"}}}static get style(){return"/**style-placeholder:app-game-player:**/"}}class d{constructor(){this.el={},this.gameState=i.Play,this.highRollerStage=l.WAITING_FOR_P1_COMMITMENT,this.isProposing=!0,this.betAmount="0.01 ETH",this.account={user:{username:"Facundo"}},this.opponent={attributes:{username:"John"}},this.label=""}get gameStatusLabelForTurn(){return this.label?this.label:this.highRollerStage===l.WAITING_FOR_P1_COMMITMENT||!this.isProposing&&this.highRollerStage===l.P1_COMMITTED_TO_HASH?"Your turn":`${this.opponent.attributes.username}'s turn`}render(){return t("div",{class:"divider"},this.gameState===i.Play?t("div",{class:"divider__status divider__status--turn"},this.gameStatusLabelForTurn):this.gameState===i.Won?t("div",{class:"divider__status divider__status--won"},t("span",{class:"result"},"You Won!"),t("span",{class:"reward"},this.betAmount)):this.gameState===i.Lost?t("div",{class:"divider__status divider__status--lost"},t("span",{class:"result"},"You Lost!"),t("span",{class:"reward"},this.betAmount)):t("div",{class:"divider__status divider__status--turn"},"It's a tie!"))}static get is(){return"app-game-status"}static get encapsulation(){return"shadow"}static get properties(){return{account:{type:"Any",attr:"account"},betAmount:{type:String,attr:"bet-amount"},el:{elementRef:!0},gameState:{type:Number,attr:"game-state"},highRollerStage:{type:Number,attr:"high-roller-stage"},isProposing:{type:Boolean,attr:"is-proposing"},label:{type:String,attr:"label"},opponent:{type:"Any",attr:"opponent"}}}static get style(){return"/**style-placeholder:app-game-status:**/"}}n.injectProps(d,["account","opponent"]);export{y as AppGame,u as AppGameDie,m as AppGamePlayer,d as AppGameStatus};